=== НАЧАЛО ОБУЧЕНИЯ 2025-08-26 18:41:49 ===

[2025-08-26 18:41:49] === РЕЖИМ МАСШТАБИРОВАНИЯ: FULL ===
[2025-08-26 18:41:49] Пользователей: все
[2025-08-26 18:41:49] Данных: 100.0%
[2025-08-26 18:41:49] === ЗАГРУЗКА ДАННЫХ ===
[2025-08-26 18:41:49] Загружаем данные...
[2025-08-26 18:41:49] orders: 1,000,000 строк (использовано 28 из 28 партиций), ~2.0 MB
[2025-08-26 18:41:50] tracker: 1,000,000 строк (использовано 298 из 298 партиций), ~32.3 MB
[2025-08-26 18:41:51] items: 1,000,000 строк (использовано 200 из 200 партиций), ~7.4 MB
[2025-08-26 18:41:51] categories: 7,012 строк (использовано 1 из 1 партиций), ~1.7 MB
[2025-08-26 18:41:51] test_users: 470,347 строк (использовано 1 из 1 партиций), ~1.8 MB
[2025-08-26 18:41:51] Данные загружены
[2025-08-26 18:41:51] Фильтрация данных...
[2025-08-26 18:41:51] Фильтрация завершена
[2025-08-26 18:41:51] Загрузка данных завершена за 0:00:01.779313
[2025-08-26 18:41:51] === ЗАГРУЗКА ЭМБЕДДИНГОВ ===
[2025-08-26 18:41:51] Оптимизированная потоковая загрузка эмбеддингов...
[2025-08-26 18:41:52] Загружено эмбеддингов для 43059 товаров
[2025-08-26 18:41:52] Загрузка эмбеддингов завершена за 0:00:00.890705
[2025-08-26 18:41:52] Загружено эмбеддингов: 43059
[2025-08-26 18:41:52] === SPLIT ДАННЫХ ===
[2025-08-26 18:41:52] Split данных завершен за 0:00:00.032295
[2025-08-26 18:41:52] Train orders: 37867, Test orders: 9461
[2025-08-26 18:41:52] === ПОДГОТОВКА ВЗАИМОДЕЙСТВИЙ ===
[2025-08-26 18:41:52] Формируем матрицу взаимодействий по батчам...
[2025-08-26 18:41:52] ... для orders
[2025-08-26 18:41:52] Сохранен orders-батч 0-37867
[2025-08-26 18:41:52] ... для tracker
[2025-08-26 18:41:53] Сохранен tracker-партиция 0
[2025-08-26 18:41:53] Все батчи сохранены на диск.
[2025-08-26 18:41:53] Подготовка взаимодействий завершена за 0:00:00.968592
[2025-08-26 18:41:53] Создано файлов взаимодействий: 2
[2025-08-26 18:41:53] === ПОСЛЕДНИЕ ТОВАРЫ ===
[2025-08-26 18:41:53] Построение recent items map завершено за 0:00:00.322214
[2025-08-26 18:41:53] Пользователей с recent items: 289891
[2025-08-26 18:41:53] === ОБУЧЕНИЕ ALS ДЛЯ ПРИЗНАКОВ ===
[2025-08-26 18:41:53] Первый проход: построение маппингов...
[2025-08-26 18:41:53] Маппинги построены. Уников: users=289891, items=35645
[2025-08-26 18:41:53] Сохранение батчей на диск...
[2025-08-26 18:41:53] Постепенное обучение...
[2025-08-26 18:41:54] Очистка временных файлов...
[2025-08-26 18:41:54] Директория батчей удалена
[2025-08-26 18:41:54] Обучение завершено!
[2025-08-26 18:41:54] Считаем глобальную популярность на основе тренировочных данных...
[2025-08-26 18:41:54] Глобальная популярность рассчитана на 37861 тренировочных заказах
[2025-08-26 18:41:54] Обучение ALS завершено за 0:00:00.995079
[2025-08-26 18:41:54] Пользователей: 289891, Товаров: 35645
[2025-08-26 18:41:54] === ПОСТРОЕНИЕ ДОПОЛНИТЕЛЬНЫХ ДАННЫХ ===
[2025-08-26 18:41:54] Строим co-purchase матрицу для топ-N товаров...
[2025-08-26 18:41:54] Топ-1000 популярных товаров определены
[2025-08-26 18:41:54] Обрабатываем 165 корзин с популярными товарами
[2025-08-26 18:41:54] Уникальных популярных товаров: 1000
[2025-08-26 18:41:54] Создаем sparse матрицу из 396 взаимодействий...
[2025-08-26 18:41:54] Sparse матрица построена: torch.Size([1000, 1000]), ненулевых элементов: 308
[2025-08-26 18:41:54] Формируем рекомендации...
[2025-08-26 18:41:55] Co-purchase словарь построен для 219 товаров
[2025-08-26 18:41:55] В среднем 1.4 рекомендаций на товар
[2025-08-26 18:41:55] Co-purchase map построен: 219 товаров
[2025-08-26 18:41:56] Построение категорийных маппингов...
[2025-08-26 18:41:56] Категорийные маппинги построены: 63318 товаров, 419 категорий
[2025-08-26 18:41:56] Построение дополнительных данных завершено за 0:00:01.828098
[2025-08-26 18:41:56] === ПРЕДВАРИТЕЛЬНЫЙ РАСЧЕТ ПРИЗНАКОВ ДЛЯ LGBM ===
[2025-08-26 18:41:56] Построение словаря пользовательских признаков...
[2025-08-26 18:41:56] Агрегация по заказам...
[2025-08-26 18:41:56] Словарь пользовательских признаков построен. Записей: 289892
[2025-08-26 18:41:56] User features построены за 0:00:00.529271: 289892 пользователей
[2025-08-26 18:41:56] Построение словаря товарных признаков...
[2025-08-26 18:41:56] Добавление данных из items_df...
[2025-08-26 18:41:57] Добавление эмбеддингов...
[2025-08-26 18:41:57] Словарь товарных признаков построен. Записей: 35646
[2025-08-26 18:41:57] Item features построены за 0:00:00.339360: 35646 товаров
[2025-08-26 18:41:57] Создание UI-признаков (данные остаются на диске)
[2025-08-26 18:41:57] Создано 2 файлов UI-признаков в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-26 18:41:57] User-Item features созданы в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-26 18:41:57] Количество файлов: 2
[2025-08-26 18:41:57] User-Item features построены за 0:00:00.056725
[2025-08-26 18:41:57] Предварительный расчет признаков завершен за 0:00:00.925671
[2025-08-26 18:41:57] === ПОДГОТОВКА ДАННЫХ ДЛЯ LightGBM ===
[2025-08-26 18:41:57] Подготовка данных для LightGBM (streaming)...
[2025-08-26 18:42:58] Обучение матрицы ковизитации на train данных...
[2025-08-26 18:42:58] Размер матрицы ковизитации: 0 товаров
[2025-08-26 18:42:58] Добавление фичей для train данных...
[2025-08-26 18:42:58] Добавление богатых признаков...
[2025-08-26 18:42:58] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-26 18:43:01] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-26 18:43:01] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-26 18:43:01] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-26 18:43:01] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-26 18:43:01] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-26 18:43:01] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-26 18:43:01] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-26 18:43:01] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-26 18:43:01] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-26 18:43:01] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-26 18:43:01] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'user_activity', 'user_avg_item_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-26 18:43:01] Всего фич после добавления: 17
[2025-08-26 18:43:01] Добавление фичей для val данных (на основе train статистик)...
[2025-08-26 18:43:01] Добавление богатых признаков...
[2025-08-26 18:43:01] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-26 18:43:04] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-26 18:43:04] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-26 18:43:04] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-26 18:43:04] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-26 18:43:04] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-26 18:43:04] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-26 18:43:04] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-26 18:43:04] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-26 18:43:04] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-26 18:43:04] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-26 18:43:04] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'user_activity', 'user_avg_item_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-26 18:43:04] Всего фич после добавления: 17
[2025-08-26 18:43:04] Добавлены UI признаки: ['ui_count', 'ui_sum', 'ui_max', 'ui_min', 'ui_mean', 'ui_days_since_last', 'ui_days_since_first']
[2025-08-26 18:43:04] TRAIN: rows=100858; target_counts={0: 79167, 1: 21691}
[2025-08-26 18:43:04] VAL: rows=11207; target_counts={0: 8808, 1: 2399}
[2025-08-26 18:43:04] split_time = 2025-06-25 20:19:58.763000 (val_days=7)
[2025-08-26 18:43:04] ✅ Данные подготовлены: train=100858, val=11207
[2025-08-26 18:43:04] Размер train: 80553, validation: 20305
[2025-08-26 18:43:04] Признаки: 24
[2025-08-26 18:43:04] Подготовка данных для LightGBM завершена за 0:01:07.339191
[2025-08-26 18:43:04] === ОБУЧЕНИЕ LightGBM ===
[2025-08-26 18:43:04] Размер тренировочных данных: 80553
[2025-08-26 18:43:04] Количество групп: 21663
[2025-08-26 18:43:04] Начинаем обучение LightGBM...
[2025-08-26 18:43:05] Обучение LightGBM завершено за 0:00:00.776670
[2025-08-26 18:43:05] === ОЦЕНКА МОДЕЛИ ===
[2025-08-26 18:43:05] NDCG@100 train: 0.6382
[2025-08-26 18:43:05] NDCG@100 val: 0.6267
[2025-08-26 18:43:05] Оценка модели завершена за 0:00:00.581583
[2025-08-26 18:43:05] === ВАЖНОСТЬ ПРИЗНАКОВ ===
[2025-08-26 18:43:05] Топ-20 важных признаков:
[2025-08-26 18:43:05]   user_avg_item_popularity: 27
[2025-08-26 18:43:05]   item_popularity: 8
[2025-08-26 18:43:05]   user_activity: 6
[2025-08-26 18:43:05]   fclip_embed_2: 4
[2025-08-26 18:43:05]   ui_count: 4
[2025-08-26 18:43:05]   fclip_embed_5: 3
[2025-08-26 18:43:05]   fclip_embed_3: 3
[2025-08-26 18:43:05]   fclip_embed_1: 2
[2025-08-26 18:43:05]   fclip_embed_0: 1
[2025-08-26 18:43:05]   fclip_embed_4: 1
[2025-08-26 18:43:05]   fclip_embed_7: 1
[2025-08-26 18:43:05]   category_popularity: 0
[2025-08-26 18:43:05]   covisitation_score: 0
[2025-08-26 18:43:05]   is_weekend: 0
[2025-08-26 18:43:05]   hour: 0
[2025-08-26 18:43:05]   fclip_embed_6: 0
[2025-08-26 18:43:05]   fclip_embed_8: 0
[2025-08-26 18:43:05]   fclip_embed_9: 0
[2025-08-26 18:43:05]   ui_sum: 0
[2025-08-26 18:43:05]   ui_max: 0
[2025-08-26 18:43:05] Анализ важности признаков завершен за 0:00:00.001585
[2025-08-26 18:43:05] === СОХРАНЕНИЕ МОДЕЛИ И ПРИЗНАКОВ ===
[2025-08-26 18:43:06] Сохранение модели завершено за 0:00:00.646659
[2025-08-26 18:43:06] Модель сохранена в: /home/root6/python/e_cup/rec_system/src/models/lgbm_model_full.pkl
[2025-08-26 18:43:06] === ОБУЧЕНИЕ ЗАВЕРШЕНО УСПЕШНО ===
[2025-08-26 18:43:06] Общее время выполнения: 0:01:17.089148
[2025-08-26 18:43:06] Пользователей: 289891
[2025-08-26 18:43:06] Товаров: 35645
[2025-08-26 18:43:06] Признаков: 24
[2025-08-26 18:43:06] NDCG@100 train: 0.6382
[2025-08-26 18:43:06] NDCG@100 val: 0.6267
[2025-08-26 18:43:06] === СИСТЕМНАЯ ИНФОРМАЦИЯ ===
[2025-08-26 18:43:06] Видеокарта: NVIDIA GeForce RTX 4090
[2025-08-26 18:43:06] Память GPU: 24.0 GB
[2025-08-26 18:43:06] Процессор: 11.0% загрузки
[2025-08-26 18:43:06] Ядра CPU: 32
[2025-08-26 18:43:06] Частота CPU: 2995.2 MHz
[2025-08-26 18:43:06] Оперативная память: 94.2 GB всего, 6.8 GB использовано
[2025-08-26 18:43:06] Частота RAM: информация требует дополнительных библиотек
[2025-08-26 18:43:06] ==========================================
[2025-08-26 18:43:06] ВСЕ ЭТАПЫ ВЫПОЛНЕНЫ УСПЕШНО!
[2025-08-26 18:43:06] ==========================================

=== ОБЩЕЕ ВРЕМЯ ВЫПОЛНЕНИЯ: 0:01:17.090108 ===
