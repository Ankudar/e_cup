=== НАЧАЛО ОБУЧЕНИЯ 2025-08-28 09:10:09 ===

[2025-08-28 09:10:09] === РЕЖИМ МАСШТАБИРОВАНИЯ: FULL ===
[2025-08-28 09:10:09] Пользователей: все
[2025-08-28 09:10:09] Данных: 100.0%
[2025-08-28 09:10:09] === ЗАГРУЗКА ДАННЫХ ===
[2025-08-28 09:10:09] Загружаем данные...
[2025-08-28 09:10:10] orders: 100,000 строк (использовано 5 из 5 партиций), ~3.8 MB
[2025-08-28 09:10:11] tracker: 100,000 строк (использовано 200 из 200 партиций), ~3.2 MB
[2025-08-28 09:10:11] items: 100,000 строк (использовано 200 из 200 партиций), ~7.4 MB
[2025-08-28 09:10:11] categories: 7,012 строк (использовано 1 из 1 партиций), ~1.7 MB
[2025-08-28 09:10:11] test_users: 100,000 строк (использовано 1 из 1 партиций), ~0.4 MB
[2025-08-28 09:10:11] Данные загружены
[2025-08-28 09:10:11] Фильтрация данных...
[2025-08-28 09:10:11] Фильтрация завершена
[2025-08-28 09:10:11] Загрузка данных завершена за 0:00:02.016638
[2025-08-28 09:10:11] === ЗАГРУЗКА ЭМБЕДДИНГОВ ===
[2025-08-28 09:10:11] Оптимизированная потоковая загрузка эмбеддингов...
[2025-08-28 09:10:12] Загружено эмбеддингов для 43059 товаров
[2025-08-28 09:10:12] Пример ключей в embeddings_dict: [400301, 678602, 746401, 872829, 893255]
[2025-08-28 09:10:12] Пример значения: [ 0.32023853  0.11766258 -0.784552    0.4168199  -0.24610527]
[2025-08-28 09:10:12] Загрузка эмбеддингов завершена за 0:00:00.910547
[2025-08-28 09:10:12] Загружено эмбеддингов: 43059
[2025-08-28 09:10:12] === SPLIT ДАННЫХ ===
[2025-08-28 09:10:13] Split данных завершен за 0:00:00.284037
[2025-08-28 09:10:13] Train orders: 75737, Test orders: 18934
[2025-08-28 09:10:13] === ПОДГОТОВКА ВЗАИМОДЕЙСТВИЙ ===
[2025-08-28 09:10:13] Формируем матрицу взаимодействий по батчам...
[2025-08-28 09:10:13] ... для orders
[2025-08-28 09:10:13] Сохранен orders-батч 0-75737
[2025-08-28 09:10:13] ... для tracker
[2025-08-28 09:10:13] Сохранен tracker-партиция 0
[2025-08-28 09:10:13] Все батчи сохранены на диск.
[2025-08-28 09:10:13] Подготовка взаимодействий завершена за 0:00:00.774051
[2025-08-28 09:10:13] Создано файлов взаимодействий: 2
[2025-08-28 09:10:13] === ПОСЛЕДНИЕ ТОВАРЫ ===
[2025-08-28 09:10:13] Словарь сохранен в /home/root6/python/e_cup/rec_system/data/processed/recent_items_map.pkl
[2025-08-28 09:10:13] Построение recent items map завершено за 0:00:00.067487
[2025-08-28 09:10:13] Пользователей с recent items: 95951
[2025-08-28 09:10:13] === ОБУЧЕНИЕ ALS ДЛЯ ПРИЗНАКОВ ===
[2025-08-28 09:10:13] Первый проход: построение маппингов...
[2025-08-28 09:10:14] Маппинги построены. Уников: users=95951, items=21340
[2025-08-28 09:10:14] item_map сохранен: /home/root6/python/e_cup/rec_system/data/processed/item_map.pkl
[2025-08-28 09:10:14] Сохранение батчей на диск...
[2025-08-28 09:10:14] Постепенное обучение...
[2025-08-28 09:10:14] Очистка временных файлов...
[2025-08-28 09:10:14] Директория батчей удалена
[2025-08-28 09:10:14] Обучение завершено!
[2025-08-28 09:10:14] Считаем глобальную популярность на основе тренировочных данных...
[2025-08-28 09:10:14] Глобальная популярность рассчитана на 75736 тренировочных заказах
[2025-08-28 09:10:14] Обучение ALS завершено за 0:00:00.869938
[2025-08-28 09:10:14] Пользователей: 95951, Товаров: 21340
[2025-08-28 09:10:14] === ПОСТРОЕНИЕ ДОПОЛНИТЕЛЬНЫХ ДАННЫХ ===
[2025-08-28 09:10:14] Строим co-purchase матрицу для топ-N товаров...
[2025-08-28 09:10:14] Топ-500 популярных товаров определены
[2025-08-28 09:10:15] Обрабатываем 237 корзин с популярными товарами
[2025-08-28 09:10:15] Уникальных популярных товаров: 500
[2025-08-28 09:10:15] Создаем sparse матрицу из 4144 взаимодействий...
[2025-08-28 09:10:15] Sparse матрица построена: torch.Size([500, 500]), ненулевых элементов: 134
[2025-08-28 09:10:15] Формируем рекомендации...
[2025-08-28 09:10:15] Co-purchase словарь построен для 126 товаров
[2025-08-28 09:10:15] В среднем 1.1 рекомендаций на товар
[2025-08-28 09:10:15] Co-purchase map построен: 126 товаров
[2025-08-28 09:10:15] Построение категорийных маппингов...
[2025-08-28 09:10:16] Категорийные маппинги построены: 63318 товаров, 419 категорий
[2025-08-28 09:10:16] Построение дополнительных данных завершено за 0:00:01.148043
[2025-08-28 09:10:16] === ПРЕДВАРИТЕЛЬНЫЙ РАСЧЕТ ПРИЗНАКОВ ДЛЯ LGBM ===
[2025-08-28 09:10:16] Построение словаря пользовательских признаков...
[2025-08-28 09:10:16] Агрегация по заказам...
[2025-08-28 09:10:16] Словарь пользовательских признаков построен и сохранён в /home/root6/python/e_cup/rec_system/data/processed/cat_to_items.pkl. Записей: 95952
[2025-08-28 09:10:16] User features построены за 0:00:00.454313: 95952 пользователей
[2025-08-28 09:10:16] Построение словаря товарных признаков...
[2025-08-28 09:10:16] Добавление данных из items_df...
[2025-08-28 09:10:16] Добавление эмбеддингов...
[2025-08-28 09:10:17] Словарь товарных признаков построен. Записей: 21341
[2025-08-28 09:10:17] Item features: 21341 товаров, размер вектора: 12 признаков
[2025-08-28 09:10:17] Порядок признаков: ['item_count', 'item_mean', 'item_sum', 'item_max', 'item_min', 'item_orders_count', 'item_category', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2']...
[2025-08-28 09:10:17] item_features_dict[114471053] type=<class 'numpy.ndarray'>, shape=(12,), example=[ 2.         7.2718024 14.543605   8.523741   6.019864 ]
[2025-08-28 09:10:17] item_features_dict[339089478] type=<class 'numpy.ndarray'>, shape=(12,), example=[ 7.         6.8893456 48.22542    7.483212   5.207269 ]
[2025-08-28 09:10:17] item_features_dict[None] type=<class 'numpy.ndarray'>, shape=(12,), example=[0. 0. 0. 0. 0.]
[2025-08-28 09:10:17] item_features_dict[244361952] type=<class 'numpy.ndarray'>, shape=(12,), example=[ 4.         6.904889  27.619556   7.9800744  4.904146 ]
[2025-08-28 09:10:17] item_features_dict[229330749] type=<class 'numpy.ndarray'>, shape=(12,), example=[2.        3.4573886 6.9147773 4.7775574 2.1372201]
[2025-08-28 09:10:17] Item features построены за 0:00:00.595199
[2025-08-28 09:10:17] === ПОДГОТОВКА ДАННЫХ ДЛЯ LightGBM ===
[2025-08-28 09:10:17] Подготовка данных для LightGBM (streaming, polars)...
[2025-08-28 09:10:17] min_timestamp=2024-12-31 21:07:27; max_timestamp=2025-05-27 21:40:49.923000; duration=147 days, 0:33:22.923000
[2025-08-28 09:10:17] split_time=2025-04-28 11:58:09.338400; train_timestamp_fill=2025-04-28 11:58:08.338400
