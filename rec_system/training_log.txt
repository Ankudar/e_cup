=== НАЧАЛО ОБУЧЕНИЯ 2025-08-27 02:09:32 ===

[2025-08-27 02:09:32] === РЕЖИМ МАСШТАБИРОВАНИЯ: FULL ===
[2025-08-27 02:09:32] Пользователей: все
[2025-08-27 02:09:32] Данных: 100.0%
[2025-08-27 02:09:32] === ЗАГРУЗКА ДАННЫХ ===
[2025-08-27 02:09:32] Загружаем данные...
[2025-08-27 02:09:32] orders: 1,475,216 строк (использовано 28 из 28 партиций), ~67.1 MB
[2025-08-27 02:09:33] tracker: 500,000,000 строк (использовано 298 из 298 партиций), ~270.0 MB
[2025-08-27 02:09:39] items: 6,439,422 строк (использовано 200 из 200 партиций), ~1134.2 MB
[2025-08-27 02:09:39] categories: 7,012 строк (использовано 1 из 1 партиций), ~1.7 MB
[2025-08-27 02:09:39] test_users: 470,347 строк (использовано 1 из 1 партиций), ~1.8 MB
[2025-08-27 02:09:39] Данные загружены
[2025-08-27 02:09:39] Фильтрация данных...
[2025-08-27 02:09:39] Фильтрация завершена
[2025-08-27 02:09:39] Загрузка данных завершена за 0:00:07.275984
[2025-08-27 02:09:39] === ЗАГРУЗКА ЭМБЕДДИНГОВ ===
[2025-08-27 02:09:39] Оптимизированная потоковая загрузка эмбеддингов...
[2025-08-27 02:09:57] Загружено эмбеддингов для 6342024 товаров
[2025-08-27 02:09:57] Загрузка эмбеддингов завершена за 0:00:17.993535
[2025-08-27 02:09:57] Загружено эмбеддингов: 6342024
[2025-08-27 02:09:57] === SPLIT ДАННЫХ ===
[2025-08-27 02:09:57] Split данных завершен за 0:00:00.391099
[2025-08-27 02:09:57] Train orders: 731760, Test orders: 182939
[2025-08-27 02:09:57] === ПОДГОТОВКА ВЗАИМОДЕЙСТВИЙ ===
[2025-08-27 02:09:57] Формируем матрицу взаимодействий по батчам...
[2025-08-27 02:09:57] ... для orders
[2025-08-27 02:09:58] Сохранен orders-батч 0-731760
[2025-08-27 02:09:58] ... для tracker
[2025-08-27 02:10:00] Сохранен tracker-партиция 0
[2025-08-27 02:10:00] Все батчи сохранены на диск.
[2025-08-27 02:10:00] Подготовка взаимодействий завершена за 0:00:02.593881
[2025-08-27 02:10:00] Создано файлов взаимодействий: 2
[2025-08-27 02:10:00] === ПОСЛЕДНИЕ ТОВАРЫ ===
[2025-08-27 02:10:01] Словарь сохранен в /home/root6/python/e_cup/rec_system/data/processed/recent_items_map.pkl
[2025-08-27 02:10:01] Построение recent items map завершено за 0:00:01.287037
[2025-08-27 02:10:01] Пользователей с recent items: 738373
[2025-08-27 02:10:01] === ОБУЧЕНИЕ ALS ДЛЯ ПРИЗНАКОВ ===
[2025-08-27 02:10:01] Первый проход: построение маппингов...
[2025-08-27 02:10:02] Маппинги построены. Уников: users=738373, items=441423
[2025-08-27 02:10:02] item_map сохранен: /home/root6/python/e_cup/rec_system/data/processed/item_map.pkl
[2025-08-27 02:10:02] Сохранение батчей на диск...
[2025-08-27 02:10:02] Постепенное обучение...
[2025-08-27 02:10:04] Очистка временных файлов...
[2025-08-27 02:10:04] Директория батчей удалена
[2025-08-27 02:10:04] Обучение завершено!
[2025-08-27 02:10:04] Считаем глобальную популярность на основе тренировочных данных...
[2025-08-27 02:10:04] Глобальная популярность рассчитана на 731757 тренировочных заказах
[2025-08-27 02:10:04] Обучение ALS завершено за 0:00:02.374120
[2025-08-27 02:10:04] Пользователей: 738373, Товаров: 441423
[2025-08-27 02:10:04] === ПОСТРОЕНИЕ ДОПОЛНИТЕЛЬНЫХ ДАННЫХ ===
[2025-08-27 02:10:04] Строим co-purchase матрицу для топ-N товаров...
[2025-08-27 02:10:04] Топ-1000 популярных товаров определены
[2025-08-27 02:10:09] Обрабатываем 1496 корзин с популярными товарами
[2025-08-27 02:10:09] Уникальных популярных товаров: 1000
[2025-08-27 02:10:09] Создаем sparse матрицу из 4246 взаимодействий...
[2025-08-27 02:10:09] Sparse матрица построена: torch.Size([1000, 1000]), ненулевых элементов: 2820
[2025-08-27 02:10:09] Формируем рекомендации...
[2025-08-27 02:10:09] Co-purchase словарь построен для 813 товаров
[2025-08-27 02:10:09] В среднем 3.4 рекомендаций на товар
[2025-08-27 02:10:09] Co-purchase словарь сохранен в /home/root6/python/e_cup/rec_system/data/processed/copurchase_map.pkl
[2025-08-27 02:10:09] Co-purchase map построен: 813 товаров
[2025-08-27 02:10:15] Построение категорийных маппингов...
[2025-08-27 02:10:18] Сохранено: item_to_cat.pkl и extended_cat_to_items.pkl в /home/root6/python/e_cup/rec_system/data/processed/
[2025-08-27 02:10:18] Категорийные маппинги построены: 6342024 товаров, 478 категорий
[2025-08-27 02:10:18] Построение дополнительных данных завершено за 0:00:14.332893
[2025-08-27 02:10:18] === ПРЕДВАРИТЕЛЬНЫЙ РАСЧЕТ ПРИЗНАКОВ ДЛЯ LGBM ===
[2025-08-27 02:10:18] Построение словаря пользовательских признаков...
[2025-08-27 02:10:18] Агрегация по заказам...
[2025-08-27 02:10:22] Словарь пользовательских признаков построен и сохранён в /home/root6/python/e_cup/rec_system/data/processed/user_features_dict.pkl. Записей: 738374
[2025-08-27 02:10:22] User features построены за 0:00:03.579148: 738374 пользователей
[2025-08-27 02:10:22] Построение словаря товарных признаков...
[2025-08-27 02:10:22] Добавление данных из items_df...
[2025-08-27 02:10:51] Добавление эмбеддингов...
[2025-08-27 02:10:52] Словарь товарных признаков построен. Записей: 441424
[2025-08-27 02:10:53] Словарь сохранён в /home/root6/python/e_cup/rec_system/data/processed/item_features_dict.pkl
[2025-08-27 02:10:53] Item features построены за 0:00:31.364418: 441424 товаров
[2025-08-27 02:10:53] Создание UI-признаков (данные остаются на диске)
[2025-08-27 02:10:53] Создано 2 файлов UI-признаков в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-27 02:10:53] User-Item features созданы в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-27 02:10:53] Количество файлов: 2
[2025-08-27 02:10:53] User-Item features построены за 0:00:00.493423
[2025-08-27 02:10:53] Предварительный расчет признаков завершен за 0:00:35.437328
[2025-08-27 02:10:53] === ПОДГОТОВКА ДАННЫХ ДЛЯ LightGBM ===
[2025-08-27 02:10:53] Подготовка данных для LightGBM (streaming)...
[2025-08-27 02:25:47] Обучение матрицы ковизитации на train данных...
[2025-08-27 02:26:02] Размер матрицы ковизитации: 381 товаров
[2025-08-27 02:26:03] Добавление фичей для train данных...
[2025-08-27 02:26:03] Добавление богатых признаков...
[2025-08-27 02:26:03] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-27 02:31:53] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-27 02:31:55] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-27 02:31:58] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-27 02:32:01] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-27 02:32:04] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-27 02:32:07] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-27 02:32:10] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-27 02:32:13] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-27 02:32:16] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-27 02:32:19] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-27 02:32:22] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'user_activity', 'user_avg_item_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-27 02:32:22] Всего фич после добавления: 17
[2025-08-27 02:32:22] Добавление фичей для val данных (на основе train статистик)...
[2025-08-27 02:32:22] Добавление богатых признаков...
[2025-08-27 02:32:22] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-27 02:38:07] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-27 02:38:08] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-27 02:38:08] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-27 02:38:08] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-27 02:38:09] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-27 02:38:09] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-27 02:38:10] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-27 02:38:10] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-27 02:38:10] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-27 02:38:10] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-27 02:38:11] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'user_activity', 'user_avg_item_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-27 02:38:11] Всего фич после добавления: 17
[2025-08-27 02:38:14] Добавлены UI признаки: ['ui_count', 'ui_sum', 'ui_max', 'ui_min', 'ui_mean', 'ui_days_since_last', 'ui_days_since_first']
[2025-08-27 02:38:14] TRAIN: rows=1955446; target_counts={0: 1518337, 1: 437109}
[2025-08-27 02:38:14] VAL: rows=217272; target_counts={0: 170626, 1: 46646}
[2025-08-27 02:38:14] split_time = 2025-07-03 18:10:19.620000 (val_days=7)
[2025-08-27 02:38:14] ✅ Данные подготовлены: train=1955446, val=217272
[2025-08-27 02:38:15] Размер train: 1563598, validation: 391848
[2025-08-27 02:38:15] Признаки: 24
[2025-08-27 02:38:15] Подготовка данных для LightGBM завершена за 0:27:21.085871
[2025-08-27 02:38:15] === ДЕТАЛЬНАЯ ПРОВЕРКА FEATURE GENERATION ===
[2025-08-27 02:38:15] --- ПРОВЕРКА USER FEATURES ---
[2025-08-27 02:38:15] Пример user features для пользователя 3880101:
[2025-08-27 02:38:15]   user_count: 2
[2025-08-27 02:38:15]   user_mean: 3.256085971177316
[2025-08-27 02:38:15]   user_sum: 6.512171942354632
[2025-08-27 02:38:15]   user_max: 3.7229856144854603
[2025-08-27 02:38:15]   user_min: 2.7891863278691713
[2025-08-27 02:38:15]   user_last_ts: 2025-04-10 10:31:31
[2025-08-27 02:38:15]   user_first_ts: 2025-01-27 21:11:13
[2025-08-27 02:38:15]   user_orders_count: 0
[2025-08-27 02:38:15]   user_last_order_ts: None
[2025-08-27 02:38:15]   user_first_order_ts: None
[2025-08-27 02:38:15]   user_days_since_last: 138
[2025-08-27 02:38:15]   user_days_since_first: 211
[2025-08-27 02:38:15]   user_days_since_last_order: None
[2025-08-27 02:38:15] Пользователей с features: 738374
[2025-08-27 02:38:15] Пользователей с НЕнулевыми features: 738374
[2025-08-27 02:38:15] --- ПРОВЕРКА ITEM FEATURES ---
[2025-08-27 02:38:15] Пример item features для товара 45945747:
[2025-08-27 02:38:15]   item_count: 1
[2025-08-27 02:38:15]   item_mean: 1.0486026549103453
[2025-08-27 02:38:15]   item_sum: 1.0486026549103453
[2025-08-27 02:38:15]   item_max: 1.0486026549103453
[2025-08-27 02:38:15]   item_min: 1.0486026549103453
[2025-08-27 02:38:15]   item_last_ts: 2025-07-02 21:48:28.623000
[2025-08-27 02:38:15]   item_first_ts: 2025-07-02 21:48:28.623000
[2025-08-27 02:38:15]   item_orders_count: 1
[2025-08-27 02:38:15]   item_category: 7512
[2025-08-27 02:38:15]   item_days_since_last: 55
[2025-08-27 02:38:15]   item_days_since_first: 55
[2025-08-27 02:38:15]   fclip_embed_0: -0.0925290584564209
[2025-08-27 02:38:15]   fclip_embed_1: -0.07637560367584229
[2025-08-27 02:38:15]   fclip_embed_2: 0.6703207492828369
[2025-08-27 02:38:15]   fclip_embed_3: 0.1169077530503273
[2025-08-27 02:38:15]   fclip_embed_4: 0.4625985622406006
[2025-08-27 02:38:15] Товаров с features: 441424
[2025-08-27 02:38:15] Товаров с НЕнулевыми features: 441424
[2025-08-27 02:38:15] --- ПРОВЕРКА UI FEATURES ---
[2025-08-27 02:38:15] UI features files: 2
[2025-08-27 02:38:15] UI features stats: {}
[2025-08-27 02:38:15] --- ПРОВЕРКА ЭМБЕДДИНГОВ ---
[2025-08-27 02:38:15] Пример эмбеддинга для товара 400301: shape (512,)
[2025-08-27 02:38:15] Эмбеддингов загружено: 6342024
[2025-08-27 02:38:15] Пример значений: [ 0.32023853  0.11766258 -0.784552    0.4168199  -0.24610527]
[2025-08-27 02:38:15] --- ПРОВЕРКА CO-PURCHASE MAP ---
[2025-08-27 02:38:15] Пример co-purchase для товара 175287070: 10 товаров
[2025-08-27 02:38:15] Co-purchase записей: 813
[2025-08-27 02:38:15] --- ПРОВЕРКА КАТЕГОРИЙНЫХ МАППИНГОВ ---
[2025-08-27 02:38:15] Товар 400301 -> категория 17080
[2025-08-27 02:38:15] Категория 17080 -> 16555 товаров
[2025-08-27 02:38:15] Товаров в маппинге: 6342024
[2025-08-27 02:38:15] Категорий в маппинге: 478
[2025-08-27 02:38:15] Проверка признаков завершена за 0:00:00.353630
[2025-08-27 02:38:15] === ОБУЧЕНИЕ LightGBM ===
[2025-08-27 02:38:15] Размер train: 1563598
[2025-08-27 02:38:15] Размер val: 391848
[2025-08-27 02:38:34] NDCG@100 на валидации: 0.7024
[2025-08-27 02:38:34] Обучение LightGBM завершено за 0:00:18.612087
[2025-08-27 02:38:34] === ОЦЕНКА МОДЕЛИ ===
[2025-08-27 02:38:43] NDCG@100 train: 0.7044
[2025-08-27 02:38:43] NDCG@100 val: 0.7024
[2025-08-27 02:38:43] Оценка модели завершена за 0:00:08.984249
[2025-08-27 02:38:43] === ВАЖНОСТЬ ПРИЗНАКОВ ===
[2025-08-27 02:38:43] Топ-20 важных признаков:
[2025-08-27 02:38:43]   user_activity: 3682
[2025-08-27 02:38:43]   user_avg_item_popularity: 3330
[2025-08-27 02:38:43]   item_popularity: 2421
[2025-08-27 02:38:43]   fclip_embed_1: 2076
[2025-08-27 02:38:43]   fclip_embed_2: 1909
[2025-08-27 02:38:43]   fclip_embed_7: 1905
[2025-08-27 02:38:43]   fclip_embed_6: 1785
[2025-08-27 02:38:43]   fclip_embed_0: 1783
[2025-08-27 02:38:43]   fclip_embed_4: 1754
[2025-08-27 02:38:43]   fclip_embed_8: 1725
[2025-08-27 02:38:43]   fclip_embed_3: 1720
[2025-08-27 02:38:43]   fclip_embed_9: 1599
[2025-08-27 02:38:43]   fclip_embed_5: 1562
[2025-08-27 02:38:43]   ui_count: 848
[2025-08-27 02:38:43]   ui_sum: 498
[2025-08-27 02:38:43]   ui_days_since_last: 359
[2025-08-27 02:38:43]   ui_days_since_first: 248
[2025-08-27 02:38:43]   covisitation_score: 190
[2025-08-27 02:38:43]   ui_max: 171
[2025-08-27 02:38:43]   ui_mean: 153
[2025-08-27 02:38:43] Анализ важности признаков завершен за 0:00:00.002002
[2025-08-27 02:38:43] === СОХРАНЕНИЕ МОДЕЛИ И ПРИЗНАКОВ ===
[2025-08-27 02:38:47] Сохранение модели завершено за 0:00:03.977943
[2025-08-27 02:38:47] Модель сохранена в: /home/root6/python/e_cup/rec_system/src/models/lgbm_model_full.pkl
[2025-08-27 02:38:47] === ОБУЧЕНИЕ И ПРЕДСКАЗАНИЯ ЗАВЕРШЕНЫ УСПЕШНО ===
[2025-08-27 02:38:47] Общее время выполнения: 0:29:14.703749
[2025-08-27 02:38:47] Пользователей: 738373
[2025-08-27 02:38:47] Товаров: 441423
[2025-08-27 02:38:47] Признаков: 24
[2025-08-27 02:38:47] NDCG@100 train: 0.7044
[2025-08-27 02:38:47] NDCG@100 val: 0.7024
[2025-08-27 02:38:47] === СИСТЕМНАЯ ИНФОРМАЦИЯ ===
[2025-08-27 02:38:47] Видеокарта: NVIDIA GeForce RTX 4090
[2025-08-27 02:38:47] Память GPU: 24.0 GB
[2025-08-27 02:38:47] Процессор: 10.2% загрузки
[2025-08-27 02:38:47] Ядра CPU: 32
[2025-08-27 02:38:47] Частота CPU: 2995.2 MHz
[2025-08-27 02:38:47] Оперативная память: 94.2 GB всего, 68.7 GB использовано
[2025-08-27 02:38:47] Частота RAM: информация требует дополнительных библиотек
[2025-08-27 02:38:47] ==========================================
[2025-08-27 02:38:47] ВСЕ ЭТАПЫ ВЫПОЛНЕНЫ УСПЕШНО!
[2025-08-27 02:38:47] ==========================================

=== ОБЩЕЕ ВРЕМЯ ВЫПОЛНЕНИЯ: 0:29:14.704829 ===
