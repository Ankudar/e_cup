=== НАЧАЛО ОБУЧЕНИЯ 2025-08-31 15:09:45 ===

[2025-08-31 15:09:45] === РЕЖИМ МАСШТАБИРОВАНИЯ: FULL ===
[2025-08-31 15:09:45] Пользователей: все
[2025-08-31 15:09:45] Данных: 100.0%
[2025-08-31 15:09:45] === ЗАГРУЗКА ДАННЫХ ===
[2025-08-31 15:09:45] Загружаем данные...
[2025-08-31 15:09:45] orders: найдено 5 файлов, используем 5
[2025-08-31 15:09:47] orders: ограничено 1,000 из 18,887,122 строк (семплирование 0.0%, использовано 5 файлов), ~0.0 MB
[2025-08-31 15:09:47] tracker: найдено 200 файлов, используем 200
[2025-08-31 15:11:48] tracker: ограничено 1,001 из 1,644,982,482 строк (семплирование 0.0%, использовано 200 файлов), ~0.0 MB
[2025-08-31 15:11:48] items: найдено 100 файлов, используем 100
[2025-08-31 15:11:59] items: ограничено 1,000 из 6,439,422 строк (семплирование 0.0%, использовано 100 файлов), ~0.2 MB
[2025-08-31 15:11:59] categories: найдено 1 файлов, используем 1
[2025-08-31 15:11:59] categories: ограничено 1,000 из 7,012 строк (семплирование 14.3%, использовано 1 файлов), ~0.2 MB
[2025-08-31 15:11:59] test_users: найдено 1 файлов, используем 1
[2025-08-31 15:11:59] test_users: ограничено 1,000 из 470,347 строк (семплирование 0.2%, использовано 1 файлов), ~0.0 MB
[2025-08-31 15:11:59] Данные загружены
[2025-08-31 15:11:59] Фильтрация данных...
[2025-08-31 15:11:59] Фильтрация завершена
[2025-08-31 15:11:59] Загрузка данных завершена за 0:02:14.073086
[2025-08-31 15:11:59] === SPLIT ДАННЫХ ===
[2025-08-31 15:12:00] Split данных завершен за 0:00:00.781581
[2025-08-31 15:12:00] Train orders: 764, Test orders: 190
[2025-08-31 15:12:00] === ПОДГОТОВКА ВЗАИМОДЕЙСТВИЙ ===
[2025-08-31 15:12:00] Формируем матрицу взаимодействий по батчам...
[2025-08-31 15:12:00] ✅ Найдено 11 существующих файлов, пропускаем создание
[2025-08-31 15:12:00] Подготовка взаимодействий завершена за 0:00:00.000227
[2025-08-31 15:12:00] Создано файлов взаимодействий: 11
[2025-08-31 15:12:00] === ПОСЛЕДНИЕ ТОВАРЫ ===
[2025-08-31 15:12:07] Словарь сохранен в /home/root6/python/e_cup/rec_system/data/processed/recent_items_map.pkl
[2025-08-31 15:12:07] Построение recent items map завершено за 0:00:07.449357
[2025-08-31 15:12:07] Пользователей с recent items: 942507
[2025-08-31 15:12:07] === ОБУЧЕНИЕ ALS ДЛЯ ПРИЗНАКОВ ===
[2025-08-31 15:12:07] Первый проход: построение маппингов...
[2025-08-31 15:12:08] Маппинги построены. Уников: users=942507, items=238110
[2025-08-31 15:12:08] item_map сохранен: /home/root6/python/e_cup/rec_system/data/processed/item_map.pkl
[2025-08-31 15:12:08] Сохранение батчей на диск...
[2025-08-31 15:12:09] Обучение als_model...
[2025-08-31 15:12:17] Очистка временных файлов...
[2025-08-31 15:12:17] Директория батчей удалена
[2025-08-31 15:12:17] Обучение завершено!
[2025-08-31 15:12:17] Считаем глобальную популярность на основе тренировочных данных...
[2025-08-31 15:12:17] Глобальная популярность рассчитана на 763 тренировочных заказах
[2025-08-31 15:12:17] Обучение ALS завершено за 0:00:10.164973
[2025-08-31 15:12:17] Пользователей: 942507, Товаров: 238110
[2025-08-31 15:12:17] === ПОСТРОЕНИЕ ДОПОЛНИТЕЛЬНЫХ ДАННЫХ ===
[2025-08-31 15:12:17] Строим co-purchase матрицу для топ-N товаров...
[2025-08-31 15:12:17] Топ-500 популярных товаров определены
[2025-08-31 15:12:17] Нет корзин с популярными товарами
[2025-08-31 15:12:17] Co-purchase map построен: 0 товаров
[2025-08-31 15:12:23] Построение категорийных маппингов...
[2025-08-31 15:12:23] Категорийные маппинги построены: 1000 товаров, 228 категорий
[2025-08-31 15:12:23] Построение дополнительных данных завершено за 0:00:05.497495
[2025-08-31 15:12:23] === ПРЕДВАРИТЕЛЬНЫЙ РАСЧЕТ ПРИЗНАКОВ ДЛЯ LGBM ===
[2025-08-31 15:12:23] Построение словаря пользовательских признаков...
[2025-08-31 15:12:24] Агрегация по заказам...
[2025-08-31 15:12:25] Словарь пользовательских признаков построен и сохранён в /home/root6/python/e_cup/rec_system/data/processed/cat_to_items.pkl. Записей: 942508
[2025-08-31 15:12:25] User features построены за 0:00:02.240246: 942508 пользователей
[2025-08-31 15:12:25] Построение словаря товарных признаков с батчевой обработкой...
[2025-08-31 15:12:25] Батчевая агрегация взаимодействий...
[2025-08-31 15:12:26] Объединение статистик...
[2025-08-31 15:12:26] Обработка заказов...
[2025-08-31 15:12:28] Ошибка обработки партиции 3: tuple index out of range
[2025-08-31 15:12:28] Ошибка обработки партиции 4: tuple index out of range
[2025-08-31 15:12:28] Обработка items...
[2025-08-31 15:12:29] Объединение всех данных...
[2025-08-31 15:12:29] Создание финального словаря...
[2025-08-31 15:12:29] Очистка временных файлов...
[2025-08-31 15:12:29] Словарь товарных признаков построен. Записей: 239252
[2025-08-31 15:12:29] Item features: 239252 товаров, размер вектора: 7 признаков
[2025-08-31 15:12:29] Порядок признаков: ['item_min', 'item_max', 'item_count', 'item_sum', 'item_orders_count', 'item_category', 'item_mean']
[2025-08-31 15:12:29] item_features_dict[27262977] type=<class 'numpy.ndarray'>, shape=(7,), example=[  5.9098206  33.741688   78.        562.8679      0.       ]
[2025-08-31 15:12:29] item_features_dict[298844161] type=<class 'numpy.ndarray'>, shape=(7,), example=[  4.7957907  32.108437   13.        106.16929     0.       ]
[2025-08-31 15:12:29] item_features_dict[251658241] type=<class 'numpy.ndarray'>, shape=(7,), example=[  1.7509375  27.850113   26.        150.81177     0.       ]
[2025-08-31 15:12:29] item_features_dict[71303174] type=<class 'numpy.ndarray'>, shape=(7,), example=[  0.36464313  17.03921     22.         153.79848      0.        ]
[2025-08-31 15:12:29] item_features_dict[232259597] type=<class 'numpy.ndarray'>, shape=(7,), example=[3.6464313e-01 3.0540012e+01 2.1100000e+02 8.8817621e+02 0.0000000e+00]
[2025-08-31 15:12:29] Item features построены за 0:00:04.341180
[2025-08-31 15:12:29] === ПОДГОТОВКА ДАННЫХ ДЛЯ LightGBM ===
[2025-08-31 15:12:29] Подготовка данных для LightGBM (streaming, polars lazy, батчи)...
[2025-08-31 15:12:32] ✅ Данные подготовлены без утечек памяти
[2025-08-31 15:12:32] Размер train: 1109, validation: 26
[2025-08-31 15:12:32] Признаки: 13
[2025-08-31 15:12:32] Подготовка данных для LightGBM завершена за 0:00:02.759854
[2025-08-31 15:12:32] === ДЕТАЛЬНАЯ ПРОВЕРКА FEATURE GENERATION ===
[2025-08-31 15:12:32] --- ПРОВЕРКА USER FEATURES ---
[2025-08-31 15:12:32] Пример user features для пользователя 3632760:
[2025-08-31 15:12:32]   user_count: 5
[2025-08-31 15:12:32]   user_mean: 5.088614855974344
[2025-08-31 15:12:32]   user_sum: 25.443074279871716
[2025-08-31 15:12:32]   user_max: 6.828885216824352
[2025-08-31 15:12:32]   user_min: 2.4475508632442313
[2025-08-31 15:12:32]   user_orders_count: 0
[2025-08-31 15:12:32] Пользователей с features: 942508
[2025-08-31 15:12:32] Пользователей с НЕнулевыми features: 942508
[2025-08-31 15:12:32] --- ПРОВЕРКА ITEM FEATURES ---
[2025-08-31 15:12:32] Товаров с features: 239252
[2025-08-31 15:12:32] --- ПРОВЕРКА CO-PURCHASE MAP ---
[2025-08-31 15:12:32] ⚠️ copurchase_map ПУСТОЙ!
[2025-08-31 15:12:32] --- ПРОВЕРКА КАТЕГОРИЙНЫХ МАППИНГОВ ---
[2025-08-31 15:12:32] Товар 324738852 -> категория 7644
[2025-08-31 15:12:32] Категория 7644 -> 14 товаров
[2025-08-31 15:12:32] Товаров в маппинге: 1000
[2025-08-31 15:12:32] Категорий в маппинге: 228
[2025-08-31 15:12:32] Проверка признаков завершена за 0:00:00.109138
[2025-08-31 15:12:32] === ОБУЧЕНИЕ LightGBM ===
[2025-08-31 15:12:32] === ДЕБАГ ИНФОРМАЦИЯ: TRAIN ===
[2025-08-31 15:12:32] Размер: 1109 строк
[2025-08-31 15:12:32] Колонки: ['item_id', 'user_id', 'created_timestamp', 'last_status', 'target', 'weight', 'user_count', 'user_mean', 'user_sum', 'user_max', 'user_min', 'user_orders_count', 'item_count', 'item_sum', 'item_mean', 'item_max', 'item_min', 'item_orders_count', 'copurchase_count']
[2025-08-31 15:12:32] ✅ Все признаки присутствуют
[2025-08-31 15:12:32] Целевая переменная: {1: np.int64(604), 0: np.int64(505)}
[2025-08-31 15:12:32] Пример первой строки:
[2025-08-31 15:12:32]   item_id: 292553876
[2025-08-31 15:12:32]   user_id: 3939971
[2025-08-31 15:12:32]   created_timestamp: 2025-05-05 07:21:07.530000
[2025-08-31 15:12:32]   last_status: delivered_orders
[2025-08-31 15:12:32]   target: 1
[2025-08-31 15:12:32]   weight: 8.613832988705518
[2025-08-31 15:12:32]   user_count: 37.0
[2025-08-31 15:12:32]   user_mean: 4.378712648330067
[2025-08-31 15:12:32]   user_sum: 162.01236798821247
[2025-08-31 15:12:32]   user_max: 8.613832988705518
[2025-08-31 15:12:32]   user_min: 0.36464311358790924
[2025-08-31 15:12:32]   user_orders_count: 1.0
[2025-08-31 15:12:32]   item_count: 8.6138334274292
[2025-08-31 15:12:32]   item_sum: 8.6138334274292
[2025-08-31 15:12:32]   item_mean: 1.0
[2025-08-31 15:12:32]   item_max: 8.6138334274292
[2025-08-31 15:12:32]   item_min: 1.0
[2025-08-31 15:12:32]   item_orders_count: 0.0
[2025-08-31 15:12:32]   copurchase_count: 0.0
[2025-08-31 15:12:32] === ДЕБАГ ИНФОРМАЦИЯ: VAL ===
[2025-08-31 15:12:32] Размер: 26 строк
[2025-08-31 15:12:32] Колонки: ['item_id', 'user_id', 'created_timestamp', 'last_status', 'target', 'weight', 'user_count', 'user_mean', 'user_sum', 'user_max', 'user_min', 'user_orders_count', 'item_count', 'item_sum', 'item_mean', 'item_max', 'item_min', 'item_orders_count', 'copurchase_count']
[2025-08-31 15:12:32] ✅ Все признаки присутствуют
[2025-08-31 15:12:32] Целевая переменная: {0: np.int64(17), 1: np.int64(9)}
[2025-08-31 15:12:32] Пример первой строки:
[2025-08-31 15:12:32]   item_id: 242794933
[2025-08-31 15:12:32]   user_id: 1606171
[2025-08-31 15:12:32]   created_timestamp: 2025-05-28 11:16:28.460000
[2025-08-31 15:12:32]   last_status: canceled_orders
[2025-08-31 15:12:32]   target: 0
[2025-08-31 15:12:32]   weight: 0.9116077839697732
[2025-08-31 15:12:32]   user_count: 29
[2025-08-31 15:12:32]   user_mean: 5.5769778744296055
[2025-08-31 15:12:32]   user_sum: 161.73235835845855
[2025-08-31 15:12:32]   user_max: 27.97281334830153
[2025-08-31 15:12:32]   user_min: 0.36464311358790924
[2025-08-31 15:12:32]   user_orders_count: 1
[2025-08-31 15:12:32]   item_count: 0.9116078019142151
[2025-08-31 15:12:32]   item_sum: 0.9116078019142151
[2025-08-31 15:12:32]   item_mean: 1.0
[2025-08-31 15:12:32]   item_max: 0.9116078019142151
[2025-08-31 15:12:32]   item_min: 1.0
[2025-08-31 15:12:32]   item_orders_count: 0.0
[2025-08-31 15:12:32]   copurchase_count: 0.0
[2025-08-31 15:12:32] Feature columns: ['copurchase_count', 'user_count', 'user_mean', 'user_sum', 'user_max', 'user_min', 'user_orders_count', 'item_count', 'item_sum', 'item_mean', 'item_max', 'item_min', 'item_orders_count']
[2025-08-31 15:12:32] Размер train: 1109
[2025-08-31 15:12:32] Количество пользователей в train: 936
[2025-08-31 15:12:32] Размер val: 26
[2025-08-31 15:12:32] Количество пользователей в val: 18
[2025-08-31 15:12:32] [Iter 0] train_ndcg@100: 0.011752, valid_ndcg@100: 0.000000
[2025-08-31 15:12:32] ✅ [Iter 0] Новый лучший valid_ndcg@100: 0.000000
[2025-08-31 15:12:33] [Iter 5] train_ndcg@100: 0.011752, valid_ndcg@100: 0.000000
[2025-08-31 15:12:33] [Iter 10] train_ndcg@100: 0.011752, valid_ndcg@100: 0.000000
[2025-08-31 15:12:33] ⏹️ Ранняя остановка на итерации 10. Лучший NDCG@100=0.000000 (iter 0)
[2025-08-31 15:12:33] 🎯 Финальный NDCG@100 на валидации: 0.218458
[2025-08-31 15:12:33] 📈 Лучший NDCG@100: 0.000000 на итерации 0
[2025-08-31 15:12:33] Обучение LightGBM завершено за 0:00:00.699000
[2025-08-31 15:12:33] === ВАЖНОСТЬ ПРИЗНАКОВ ===
[2025-08-31 15:12:33] Топ-20 важных признаков:
[2025-08-31 15:12:33]   item_count: 4
[2025-08-31 15:12:33]   item_mean: 1
[2025-08-31 15:12:33]   user_mean: 0
[2025-08-31 15:12:33]   user_count: 0
[2025-08-31 15:12:33]   copurchase_count: 0
[2025-08-31 15:12:33]   user_max: 0
[2025-08-31 15:12:33]   user_sum: 0
[2025-08-31 15:12:33]   user_orders_count: 0
[2025-08-31 15:12:33]   user_min: 0
[2025-08-31 15:12:33]   item_sum: 0
[2025-08-31 15:12:33]   item_max: 0
[2025-08-31 15:12:33]   item_min: 0
[2025-08-31 15:12:33]   item_orders_count: 0
[2025-08-31 15:12:33] Анализ важности признаков завершен за 0:00:00.002723
[2025-08-31 15:12:33] === СОХРАНЕНИЕ МОДЕЛИ И ПРИЗНАКОВ ===
[2025-08-31 15:12:34] Сохранение модели завершено за 0:00:01.524065
[2025-08-31 15:12:34] Модель сохранена в: /home/root6/python/e_cup/rec_system/src/models/lgbm_model_full.pkl
[2025-08-31 15:12:34] === ОБУЧЕНИЕ И ПРЕДСКАЗАНИЯ ЗАВЕРШЕНЫ УСПЕШНО ===
[2025-08-31 15:12:34] Общее время выполнения: 0:02:49.644262
[2025-08-31 15:12:34] Пользователей: 942507
[2025-08-31 15:12:34] Товаров: 238110
[2025-08-31 15:12:34] Признаков: 13
[2025-08-31 15:12:34] === СИСТЕМНАЯ ИНФОРМАЦИЯ ===
[2025-08-31 15:12:34] Видеокарта: NVIDIA GeForce RTX 4090
[2025-08-31 15:12:34] Память GPU: 24.0 GB
[2025-08-31 15:12:34] Процессор: 27.5% загрузки
[2025-08-31 15:12:34] Ядра CPU: 32
[2025-08-31 15:12:34] Частота CPU: 2995.2 MHz
[2025-08-31 15:12:34] Оперативная память: 94.2 GB всего, 60.0 GB использовано
[2025-08-31 15:12:34] ==========================================
[2025-08-31 15:12:34] ВСЕ ЭТАПЫ ВЫПОЛНЕНЫ УСПЕШНО!
[2025-08-31 15:12:34] ==========================================

=== ОБЩЕЕ ВРЕМЯ ВЫПОЛНЕНИЯ: 0:02:49.645275 ===
