=== НАЧАЛО ОБУЧЕНИЯ 2025-08-27 23:30:56 ===

[2025-08-27 23:30:56] === РЕЖИМ МАСШТАБИРОВАНИЯ: FULL ===
[2025-08-27 23:30:56] Пользователей: все
[2025-08-27 23:30:56] Данных: 100.0%
[2025-08-27 23:30:56] === ЗАГРУЗКА ДАННЫХ ===
[2025-08-27 23:30:56] Загружаем данные...
[2025-08-27 23:30:56] orders: 1,000 строк (использовано 5 из 5 партиций), ~0.0 MB
[2025-08-27 23:30:57] tracker: 1,000 строк (использовано 200 из 200 партиций), ~0.0 MB
[2025-08-27 23:30:58] items: 1,000 строк (использовано 200 из 200 партиций), ~0.2 MB
[2025-08-27 23:30:58] categories: 1,000 строк (использовано 1 из 1 партиций), ~0.2 MB
[2025-08-27 23:30:58] test_users: 1,000 строк (использовано 1 из 1 партиций), ~0.0 MB
[2025-08-27 23:30:58] Данные загружены
[2025-08-27 23:30:58] Фильтрация данных...
[2025-08-27 23:30:58] Фильтрация завершена
[2025-08-27 23:30:58] Загрузка данных завершена за 0:00:02.052449
[2025-08-27 23:30:58] === ЗАГРУЗКА ЭМБЕДДИНГОВ ===
[2025-08-27 23:30:58] Оптимизированная потоковая загрузка эмбеддингов...
[2025-08-27 23:30:59] Загружено эмбеддингов для 990 товаров
[2025-08-27 23:30:59] Пример ключей в embeddings_dict: [400301, 678602, 746401, 872829, 893255]
[2025-08-27 23:30:59] Пример значения: [ 0.32023853  0.11766258 -0.784552    0.4168199  -0.24610527]
[2025-08-27 23:30:59] Загрузка эмбеддингов завершена за 0:00:00.723126
[2025-08-27 23:30:59] Загружено эмбеддингов: 990
[2025-08-27 23:30:59] === SPLIT ДАННЫХ ===
[2025-08-27 23:30:59] Split данных завершен за 0:00:00.268295
[2025-08-27 23:30:59] Train orders: 753, Test orders: 187
[2025-08-27 23:30:59] === ПОДГОТОВКА ВЗАИМОДЕЙСТВИЙ ===
[2025-08-27 23:30:59] Формируем матрицу взаимодействий по батчам...
[2025-08-27 23:30:59] ... для orders
[2025-08-27 23:30:59] Сохранен orders-батч 0-753
[2025-08-27 23:30:59] ... для tracker
[2025-08-27 23:31:00] Сохранен tracker-партиция 0
[2025-08-27 23:31:00] Все батчи сохранены на диск.
[2025-08-27 23:31:00] Подготовка взаимодействий завершена за 0:00:00.835254
[2025-08-27 23:31:00] Создано файлов взаимодействий: 2
[2025-08-27 23:31:00] === ПОСЛЕДНИЕ ТОВАРЫ ===
[2025-08-27 23:31:00] Словарь сохранен в /home/root6/python/e_cup/rec_system/data/processed/recent_items_map.pkl
[2025-08-27 23:31:00] Построение recent items map завершено за 0:00:00.025917
[2025-08-27 23:31:00] Пользователей с recent items: 1195
[2025-08-27 23:31:00] === ОБУЧЕНИЕ ALS ДЛЯ ПРИЗНАКОВ ===
[2025-08-27 23:31:00] Первый проход: построение маппингов...
[2025-08-27 23:31:00] Маппинги построены. Уников: users=1195, items=207
[2025-08-27 23:31:00] item_map сохранен: /home/root6/python/e_cup/rec_system/data/processed/item_map.pkl
[2025-08-27 23:31:00] Сохранение батчей на диск...
[2025-08-27 23:31:00] Постепенное обучение...
[2025-08-27 23:31:01] Очистка временных файлов...
[2025-08-27 23:31:01] Директория батчей удалена
[2025-08-27 23:31:01] Обучение завершено!
[2025-08-27 23:31:01] Считаем глобальную популярность на основе тренировочных данных...
[2025-08-27 23:31:01] Глобальная популярность рассчитана на 752 тренировочных заказах
[2025-08-27 23:31:01] Обучение ALS завершено за 0:00:00.944405
[2025-08-27 23:31:01] Пользователей: 1195, Товаров: 207
[2025-08-27 23:31:01] === ПОСТРОЕНИЕ ДОПОЛНИТЕЛЬНЫХ ДАННЫХ ===
[2025-08-27 23:31:01] Строим co-purchase матрицу для топ-N товаров...
[2025-08-27 23:31:01] Топ-207 популярных товаров определены
[2025-08-27 23:31:01] Обрабатываем 3 корзин с популярными товарами
[2025-08-27 23:31:01] Уникальных популярных товаров: 207
[2025-08-27 23:31:01] Создаем sparse матрицу из 6 взаимодействий...
[2025-08-27 23:31:01] Sparse матрица построена: torch.Size([207, 207]), ненулевых элементов: 3
[2025-08-27 23:31:01] Формируем рекомендации...
[2025-08-27 23:31:01] Co-purchase словарь построен для 3 товаров
[2025-08-27 23:31:01] В среднем 1.0 рекомендаций на товар
[2025-08-27 23:31:01] Co-purchase map построен: 3 товаров
[2025-08-27 23:31:01] Построение категорийных маппингов...
[2025-08-27 23:31:01] Категорийные маппинги построены: 990 товаров, 223 категорий
[2025-08-27 23:31:01] Построение дополнительных данных завершено за 0:00:00.305481
[2025-08-27 23:31:01] === ПРЕДВАРИТЕЛЬНЫЙ РАСЧЕТ ПРИЗНАКОВ ДЛЯ LGBM ===
[2025-08-27 23:31:01] Построение словаря пользовательских признаков...
[2025-08-27 23:31:01] Агрегация по заказам...
[2025-08-27 23:31:01] Словарь пользовательских признаков построен и сохранён в /home/root6/python/e_cup/rec_system/data/processed/cat_to_items.pkl. Записей: 1196
[2025-08-27 23:31:01] User features построены за 0:00:00.313667: 1196 пользователей
[2025-08-27 23:31:01] Построение словаря товарных признаков...
[2025-08-27 23:31:02] Добавление данных из items_df...
[2025-08-27 23:31:02] Добавление эмбеддингов...
[2025-08-27 23:31:02] Словарь товарных признаков построен. Записей: 208
[2025-08-27 23:31:02] Item features: 208 товаров, размер вектора: 7 признаков
[2025-08-27 23:31:02] Порядок признаков: ['item_count', 'item_mean', 'item_sum', 'item_max', 'item_min', 'item_orders_count', 'item_category']
[2025-08-27 23:31:02] item_features_dict[None] type=<class 'numpy.ndarray'>, shape=(7,), example=[0. 0. 0. 0. 0.]
[2025-08-27 23:31:02] item_features_dict[8224071] type=<class 'numpy.ndarray'>, shape=(7,), example=[1.       8.493345 8.493345 8.493345 8.493345]
[2025-08-27 23:31:02] item_features_dict[4709973] type=<class 'numpy.ndarray'>, shape=(7,), example=[1.        5.4930615 5.4930615 5.4930615 5.4930615]
[2025-08-27 23:31:02] item_features_dict[8634983] type=<class 'numpy.ndarray'>, shape=(7,), example=[ 6.         5.4156837 32.494102   8.013744   2.7502317]
[2025-08-27 23:31:02] item_features_dict[8373286] type=<class 'numpy.ndarray'>, shape=(7,), example=[ 2.         5.875791  11.751582   8.369883   3.3817003]
[2025-08-27 23:31:02] Item features построены за 0:00:00.279529
[2025-08-27 23:31:02] === ПОДГОТОВКА ДАННЫХ ДЛЯ LightGBM ===
[2025-08-27 23:31:02] Подготовка данных для LightGBM (streaming)...
[2025-08-27 23:31:02] min_timestamp=2025-01-01 07:18:57; max_timestamp=2025-05-29 08:10:22; duration=148 days 00:51:25
[2025-08-27 23:31:02] split_time (20% tail) = 2025-04-29 17:36:05; train_timestamp_fill = 2025-04-29 17:36:04
[2025-08-27 23:31:02] Определены признаки: ['copurchase_count', 'user_user_count', 'user_user_max', 'user_user_mean', 'user_user_min', 'user_user_orders_count', 'user_user_sum', 'item_emb_0', 'item_emb_1', 'item_emb_2', 'item_emb_3', 'item_emb_4', 'item_emb_5', 'item_emb_6']
[2025-08-27 23:31:02] User features: 6, Item features: 7
[2025-08-27 23:31:04] TRAIN: rows=1204; target_counts={0: 830, 1: 374}
[2025-08-27 23:31:04] ✅ В TRAIN все признаки на месте: 14 шт
[2025-08-27 23:31:04] VAL: rows=163; target_counts={1: 85, 0: 78}
[2025-08-27 23:31:04] ✅ В VAL все признаки на месте: 14 шт
[2025-08-27 23:31:04] split_time=2025-04-29 17:36:05 split_by_time=True
[2025-08-27 23:31:04] ✅ Данные подготовлены: train=1204, val=163
[2025-08-27 23:31:04] Размер train: 963, validation: 241
[2025-08-27 23:31:04] Признаки: 14
[2025-08-27 23:31:04] Подготовка данных для LightGBM завершена за 0:00:02.625046
[2025-08-27 23:31:04] === ДЕТАЛЬНАЯ ПРОВЕРКА FEATURE GENERATION ===
[2025-08-27 23:31:04] --- ПРОВЕРКА USER FEATURES ---
[2025-08-27 23:31:04] Пример user features для пользователя 994771:
[2025-08-27 23:31:04]   user_count: 1
[2025-08-27 23:31:04]   user_mean: 3.29622814442132
[2025-08-27 23:31:04]   user_sum: 3.29622814442132
[2025-08-27 23:31:04]   user_max: 3.29622814442132
[2025-08-27 23:31:04]   user_min: 3.29622814442132
[2025-08-27 23:31:04]   user_orders_count: 1
[2025-08-27 23:31:04] Пользователей с features: 1196
[2025-08-27 23:31:04] Пользователей с НЕнулевыми features: 1196
[2025-08-27 23:31:04] --- ПРОВЕРКА ITEM FEATURES ---
[2025-08-27 23:31:04] Пример item features для товара None:
[2025-08-27 23:31:04]   emb_0: 0.0
[2025-08-27 23:31:04]   emb_1: 0.0
[2025-08-27 23:31:04]   emb_2: 0.0
[2025-08-27 23:31:04]   emb_3: 0.0
[2025-08-27 23:31:04]   emb_4: 0.0
[2025-08-27 23:31:04]   emb_5: 1.0
[2025-08-27 23:31:04]   emb_6: 0.0
[2025-08-27 23:31:04] Товаров с features: 208
[2025-08-27 23:31:04] Товаров с НЕнулевыми features: 208
[2025-08-27 23:31:04] --- ПРОВЕРКА ЭМБЕДДИНГОВ ---
[2025-08-27 23:31:04] Пример эмбеддинга для товара 400301: shape (512,)
[2025-08-27 23:31:04] Эмбеддингов загружено: 990
[2025-08-27 23:31:04] Пример значений: [ 0.32023853  0.11766258 -0.784552    0.4168199  -0.24610527]
[2025-08-27 23:31:04] --- ПРОВЕРКА CO-PURCHASE MAP ---
[2025-08-27 23:31:04] Пример co-purchase для товара 10126067: 1 товаров
[2025-08-27 23:31:04] Co-purchase записей: 3
[2025-08-27 23:31:04] --- ПРОВЕРКА КАТЕГОРИЙНЫХ МАППИНГОВ ---
[2025-08-27 23:31:04] Товар 400301 -> категория 17080
[2025-08-27 23:31:04] Категория 17080 -> 4 товаров
[2025-08-27 23:31:04] Товаров в маппинге: 990
[2025-08-27 23:31:04] Категорий в маппинге: 223
[2025-08-27 23:31:04] Проверка признаков завершена за 0:00:00.001306
[2025-08-27 23:31:04] === ОБУЧЕНИЕ LightGBM ===
[2025-08-27 23:31:04] === ДЕБАГ ИНФОРМАЦИЯ: TRAIN ===
[2025-08-27 23:31:04] Размер: 1204 строк
[2025-08-27 23:31:04] Колонки: ['user_id', 'item_id', 'target', 'weight', 'copurchase_count', 'user_user_count', 'user_user_max', 'user_user_mean', 'user_user_min', 'user_user_orders_count', 'user_user_sum', 'item_emb_0', 'item_emb_1', 'item_emb_2', 'item_emb_3', 'item_emb_4', 'item_emb_5', 'item_emb_6']
[2025-08-27 23:31:04] ✅ Все признаки присутствуют
[2025-08-27 23:31:04] Целевая переменная: {0: np.int64(830), 1: np.int64(374)}
[2025-08-27 23:31:04] Пример первой строки:
[2025-08-27 23:31:04]   user_id: 3251
[2025-08-27 23:31:04]   item_id: 2071914
[2025-08-27 23:31:04]   target: 1
[2025-08-27 23:31:04]   weight: 0.0
[2025-08-27 23:31:04]   copurchase_count: 0.0
[2025-08-27 23:31:04]   user_user_count: 0
[2025-08-27 23:31:04]   user_user_max: 0.0
[2025-08-27 23:31:04]   user_user_mean: 0.0
[2025-08-27 23:31:04]   user_user_min: 0.0
[2025-08-27 23:31:04]   user_user_orders_count: 0
[2025-08-27 23:31:04]   user_user_sum: 0.0
[2025-08-27 23:31:04]   item_emb_0: 1.0
[2025-08-27 23:31:04]   item_emb_1: 0.7707533836364746
[2025-08-27 23:31:04]   item_emb_2: 0.7707533836364746
[2025-08-27 23:31:04]   item_emb_3: 0.7707533836364746
[2025-08-27 23:31:04]   item_emb_4: 0.7707533836364746
[2025-08-27 23:31:04]   item_emb_5: 4.0
[2025-08-27 23:31:04]   item_emb_6: 0.0
[2025-08-27 23:31:04] === ДЕБАГ ИНФОРМАЦИЯ: VAL ===
[2025-08-27 23:31:04] Размер: 163 строк
[2025-08-27 23:31:04] Колонки: ['user_id', 'item_id', 'target', 'weight', 'copurchase_count', 'user_user_count', 'user_user_max', 'user_user_mean', 'user_user_min', 'user_user_orders_count', 'user_user_sum', 'item_emb_0', 'item_emb_1', 'item_emb_2', 'item_emb_3', 'item_emb_4', 'item_emb_5', 'item_emb_6']
[2025-08-27 23:31:04] ✅ Все признаки присутствуют
[2025-08-27 23:31:04] Целевая переменная: {1: np.int64(85), 0: np.int64(78)}
[2025-08-27 23:31:04] Пример первой строки:
[2025-08-27 23:31:04]   user_id: 138281
[2025-08-27 23:31:04]   item_id: 415436
[2025-08-27 23:31:04]   target: 0
[2025-08-27 23:31:04]   weight: 1.561873425210762
[2025-08-27 23:31:04]   copurchase_count: 0.0
[2025-08-27 23:31:04]   user_user_count: 1
[2025-08-27 23:31:04]   user_user_max: 1.561873425210762
[2025-08-27 23:31:04]   user_user_mean: 1.561873425210762
[2025-08-27 23:31:04]   user_user_min: 1.561873425210762
[2025-08-27 23:31:04]   user_user_orders_count: 1
[2025-08-27 23:31:04]   user_user_sum: 1.561873425210762
[2025-08-27 23:31:04]   item_emb_0: 1.0
[2025-08-27 23:31:04]   item_emb_1: 1.561873435974121
[2025-08-27 23:31:04]   item_emb_2: 1.561873435974121
[2025-08-27 23:31:04]   item_emb_3: 1.561873435974121
[2025-08-27 23:31:04]   item_emb_4: 1.561873435974121
[2025-08-27 23:31:04]   item_emb_5: 1.0
[2025-08-27 23:31:04]   item_emb_6: 0.0
[2025-08-27 23:31:04] Feature columns: ['copurchase_count', 'user_user_count', 'user_user_max', 'user_user_mean', 'user_user_min', 'user_user_orders_count', 'user_user_sum', 'item_emb_0', 'item_emb_1', 'item_emb_2', 'item_emb_3', 'item_emb_4', 'item_emb_5', 'item_emb_6']
[2025-08-27 23:31:04] Размер train: 1204
[2025-08-27 23:31:04] Используемые признаки: ['copurchase_count', 'user_user_count', 'user_user_max', 'user_user_mean', 'user_user_min', 'user_user_orders_count', 'user_user_sum', 'item_emb_0', 'item_emb_1', 'item_emb_2', 'item_emb_3', 'item_emb_4', 'item_emb_5', 'item_emb_6']
[2025-08-27 23:31:04] Пример данных: {'copurchase_count': 0.0, 'user_user_count': 0.0, 'user_user_max': 0.0, 'user_user_mean': 0.0, 'user_user_min': 0.0, 'user_user_orders_count': 0.0, 'user_user_sum': 0.0, 'item_emb_0': 1.0, 'item_emb_1': 0.7707533836364746, 'item_emb_2': 0.7707533836364746, 'item_emb_3': 0.7707533836364746, 'item_emb_4': 0.7707533836364746, 'item_emb_5': 4.0, 'item_emb_6': 0.0}
[2025-08-27 23:31:04] Категориальные признаки: ['user_user_count', 'user_user_max', 'user_user_mean', 'user_user_min', 'user_user_orders_count', 'user_user_sum', 'item_emb_0', 'item_emb_1', 'item_emb_2', 'item_emb_3', 'item_emb_4', 'item_emb_5', 'item_emb_6']
[2025-08-27 23:31:04] Размер val: 163
[2025-08-27 23:31:04] [Iter 0] train_binary_logloss:0.6142, valid_binary_logloss:0.7810
[2025-08-27 23:31:04] [Iter 10] train_binary_logloss:0.5798, valid_binary_logloss:0.7677
[2025-08-27 23:31:04] [Iter 20] train_binary_logloss:0.5598, valid_binary_logloss:0.7789
[2025-08-27 23:31:04] [Iter 30] train_binary_logloss:0.5448, valid_binary_logloss:0.7926
[2025-08-27 23:31:04] [Iter 40] train_binary_logloss:0.5337, valid_binary_logloss:0.8060
[2025-08-27 23:31:04] [Iter 50] train_binary_logloss:0.5253, valid_binary_logloss:0.8260
[2025-08-27 23:31:04] NDCG@100 на валидации: 0.5185
[2025-08-27 23:31:04] Обучение LightGBM завершено за 0:00:00.056524
[2025-08-27 23:31:04] === ОЦЕНКА МОДЕЛИ ===
[2025-08-27 23:31:04] NDCG@100 train: 0.4227
[2025-08-27 23:31:04] NDCG@100 val: 0.5185
[2025-08-27 23:31:04] Оценка модели завершена за 0:00:00.040976
[2025-08-27 23:31:04] === ВАЖНОСТЬ ПРИЗНАКОВ ===
[2025-08-27 23:31:04] Топ-20 важных признаков:
[2025-08-27 23:31:04]   user_user_orders_count: 27
[2025-08-27 23:31:04]   item_emb_5: 14
[2025-08-27 23:31:04]   item_emb_0: 5
[2025-08-27 23:31:04]   item_emb_2: 5
[2025-08-27 23:31:04]   user_user_mean: 3
[2025-08-27 23:31:04]   user_user_max: 2
[2025-08-27 23:31:04]   user_user_min: 1
[2025-08-27 23:31:04]   user_user_count: 0
[2025-08-27 23:31:04]   copurchase_count: 0
[2025-08-27 23:31:04]   user_user_sum: 0
[2025-08-27 23:31:04]   item_emb_1: 0
[2025-08-27 23:31:04]   item_emb_3: 0
[2025-08-27 23:31:04]   item_emb_4: 0
[2025-08-27 23:31:04]   item_emb_6: 0
[2025-08-27 23:31:04] Анализ важности признаков завершен за 0:00:00.001350
[2025-08-27 23:31:04] === СОХРАНЕНИЕ МОДЕЛИ И ПРИЗНАКОВ ===
[2025-08-27 23:31:04] Сохранение модели завершено за 0:00:00.006020
[2025-08-27 23:31:04] Модель сохранена в: /home/root6/python/e_cup/rec_system/src/models/lgbm_model_full.pkl
[2025-08-27 23:31:04] === ОБУЧЕНИЕ И ПРЕДСКАЗАНИЯ ЗАВЕРШЕНЫ УСПЕШНО ===
[2025-08-27 23:31:04] Общее время выполнения: 0:00:08.480547
[2025-08-27 23:31:04] Пользователей: 1195
[2025-08-27 23:31:04] Товаров: 207
[2025-08-27 23:31:04] Признаков: 14
[2025-08-27 23:31:04] NDCG@100 train: 0.4227
[2025-08-27 23:31:04] NDCG@100 val: 0.5185
[2025-08-27 23:31:04] === СИСТЕМНАЯ ИНФОРМАЦИЯ ===
[2025-08-27 23:31:04] Видеокарта: NVIDIA GeForce RTX 4090
[2025-08-27 23:31:04] Память GPU: 24.0 GB
[2025-08-27 23:31:04] Процессор: 11.6% загрузки
[2025-08-27 23:31:04] Ядра CPU: 32
[2025-08-27 23:31:04] Частота CPU: 2995.2 MHz
[2025-08-27 23:31:04] Оперативная память: 94.2 GB всего, 7.5 GB использовано
[2025-08-27 23:31:04] Частота RAM: информация требует дополнительных библиотек
[2025-08-27 23:31:04] ==========================================
[2025-08-27 23:31:04] ВСЕ ЭТАПЫ ВЫПОЛНЕНЫ УСПЕШНО!
[2025-08-27 23:31:04] ==========================================

=== ОБЩЕЕ ВРЕМЯ ВЫПОЛНЕНИЯ: 0:00:08.481667 ===
