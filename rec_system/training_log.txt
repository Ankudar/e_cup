=== НАЧАЛО ОБУЧЕНИЯ 2025-08-27 13:01:06 ===

[2025-08-27 13:01:06] === РЕЖИМ МАСШТАБИРОВАНИЯ: FULL ===
[2025-08-27 13:01:06] Пользователей: все
[2025-08-27 13:01:06] Данных: 100.0%
[2025-08-27 13:01:06] === ЗАГРУЗКА ДАННЫХ ===
[2025-08-27 13:01:06] Загружаем данные...
[2025-08-27 13:01:07] orders: 1,000 строк (использовано 5 из 5 партиций), ~0.0 MB
[2025-08-27 13:01:07] tracker: 1,000 строк (использовано 200 из 200 партиций), ~0.0 MB
[2025-08-27 13:01:08] items: 1,000 строк (использовано 200 из 200 партиций), ~0.2 MB
[2025-08-27 13:01:08] categories: 1,000 строк (использовано 1 из 1 партиций), ~0.2 MB
[2025-08-27 13:01:08] test_users: 1,000 строк (использовано 1 из 1 партиций), ~0.0 MB
[2025-08-27 13:01:08] Данные загружены
[2025-08-27 13:01:08] Фильтрация данных...
[2025-08-27 13:01:08] Фильтрация завершена
[2025-08-27 13:01:08] Загрузка данных завершена за 0:00:02.073131
[2025-08-27 13:01:08] === ЗАГРУЗКА ЭМБЕДДИНГОВ ===
[2025-08-27 13:01:08] Оптимизированная потоковая загрузка эмбеддингов...
[2025-08-27 13:01:09] Загружено эмбеддингов для 990 товаров
[2025-08-27 13:01:09] Загрузка эмбеддингов завершена за 0:00:00.713560
[2025-08-27 13:01:09] Загружено эмбеддингов: 990
[2025-08-27 13:01:09] === SPLIT ДАННЫХ ===
[2025-08-27 13:01:09] Split данных завершен за 0:00:00.280524
[2025-08-27 13:01:09] Train orders: 753, Test orders: 187
[2025-08-27 13:01:09] === ПОДГОТОВКА ВЗАИМОДЕЙСТВИЙ ===
[2025-08-27 13:01:09] Формируем матрицу взаимодействий по батчам...
[2025-08-27 13:01:09] ... для orders
[2025-08-27 13:01:09] Сохранен orders-батч 0-753
[2025-08-27 13:01:09] ... для tracker
[2025-08-27 13:01:10] Сохранен tracker-партиция 0
[2025-08-27 13:01:10] Все батчи сохранены на диск.
[2025-08-27 13:01:10] Подготовка взаимодействий завершена за 0:00:00.758975
[2025-08-27 13:01:10] Создано файлов взаимодействий: 2
[2025-08-27 13:01:10] === ПОСЛЕДНИЕ ТОВАРЫ ===
[2025-08-27 13:01:10] Словарь сохранен в /home/root6/python/e_cup/rec_system/data/processed/recent_items_map.pkl
[2025-08-27 13:01:10] Построение recent items map завершено за 0:00:00.025162
[2025-08-27 13:01:10] Пользователей с recent items: 1195
[2025-08-27 13:01:10] === ОБУЧЕНИЕ ALS ДЛЯ ПРИЗНАКОВ ===
[2025-08-27 13:01:10] Первый проход: построение маппингов...
[2025-08-27 13:01:10] Маппинги построены. Уников: users=1195, items=207
[2025-08-27 13:01:10] item_map сохранен: /home/root6/python/e_cup/rec_system/data/processed/item_map.pkl
[2025-08-27 13:01:10] Сохранение батчей на диск...
[2025-08-27 13:01:10] Постепенное обучение...
[2025-08-27 13:01:11] Очистка временных файлов...
[2025-08-27 13:01:11] Директория батчей удалена
[2025-08-27 13:01:11] Обучение завершено!
[2025-08-27 13:01:11] Считаем глобальную популярность на основе тренировочных данных...
[2025-08-27 13:01:11] Глобальная популярность рассчитана на 752 тренировочных заказах
[2025-08-27 13:01:11] Обучение ALS завершено за 0:00:00.849709
[2025-08-27 13:01:11] Пользователей: 1195, Товаров: 207
[2025-08-27 13:01:11] === ПОСТРОЕНИЕ ДОПОЛНИТЕЛЬНЫХ ДАННЫХ ===
[2025-08-27 13:01:11] Строим co-purchase матрицу для топ-N товаров...
[2025-08-27 13:01:11] Топ-207 популярных товаров определены
[2025-08-27 13:01:11] Обрабатываем 3 корзин с популярными товарами
[2025-08-27 13:01:11] Уникальных популярных товаров: 207
[2025-08-27 13:01:11] Создаем sparse матрицу из 6 взаимодействий...
[2025-08-27 13:01:11] Sparse матрица построена: torch.Size([207, 207]), ненулевых элементов: 3
[2025-08-27 13:01:11] Формируем рекомендации...
[2025-08-27 13:01:11] Co-purchase словарь построен для 3 товаров
[2025-08-27 13:01:11] В среднем 1.0 рекомендаций на товар
[2025-08-27 13:01:11] Co-purchase словарь сохранен в /home/root6/python/e_cup/rec_system/data/processed/copurchase_map.pkl
[2025-08-27 13:01:11] Co-purchase map построен: 3 товаров
[2025-08-27 13:01:11] Построение категорийных маппингов...
[2025-08-27 13:01:11] Сохранено: item_to_cat.pkl и extended_cat_to_items.pkl в /home/root6/python/e_cup/rec_system/data/processed/
[2025-08-27 13:01:11] Категорийные маппинги построены: 990 товаров, 223 категорий
[2025-08-27 13:01:11] Построение дополнительных данных завершено за 0:00:00.274646
[2025-08-27 13:01:11] === ПРЕДВАРИТЕЛЬНЫЙ РАСЧЕТ ПРИЗНАКОВ ДЛЯ LGBM ===
[2025-08-27 13:01:11] Построение словаря пользовательских признаков...
[2025-08-27 13:01:11] Агрегация по заказам...
[2025-08-27 13:01:12] Словарь пользовательских признаков построен и сохранён в /home/root6/python/e_cup/rec_system/data/processed/user_features_dict.pkl. Записей: 1196
[2025-08-27 13:01:12] User features построены за 0:00:00.330988: 1196 пользователей
[2025-08-27 13:01:12] Построение словаря товарных признаков...
[2025-08-27 13:01:12] Добавление данных из items_df...
[2025-08-27 13:01:12] Добавление эмбеддингов...
[2025-08-27 13:01:12] Словарь товарных признаков построен. Записей: 208
[2025-08-27 13:01:12] Словарь сохранён в /home/root6/python/e_cup/rec_system/data/processed/item_features_dict.pkl
[2025-08-27 13:01:12] Item features построены за 0:00:00.329572: 208 товаров
[2025-08-27 13:01:12] Создание UI-признаков (данные остаются на диске)
[2025-08-27 13:01:12] Создано 2 файлов UI-признаков в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-27 13:01:12] User-Item features созданы в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-27 13:01:12] Количество файлов: 2
[2025-08-27 13:01:12] User-Item features построены за 0:00:00.014578
[2025-08-27 13:01:12] Предварительный расчет признаков завершен за 0:00:00.675305
[2025-08-27 13:01:12] === ПОДГОТОВКА ДАННЫХ ДЛЯ LightGBM ===
[2025-08-27 13:01:12] Подготовка данных для LightGBM (streaming)...
[2025-08-27 13:01:13] Обучение матрицы ковизитации на train данных...
[2025-08-27 13:01:13] Размер матрицы ковизитации: 0 товаров
[2025-08-27 13:01:13] Добавление фичей для train...
[2025-08-27 13:01:13] Добавление богатых признаков...
[2025-08-27 13:01:13] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-27 13:01:13] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'user_activity', 'user_avg_item_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-27 13:01:13] Всего фич после добавления: 17
[2025-08-27 13:01:13] Добавление фичей для val...
[2025-08-27 13:01:13] Добавление богатых признаков...
[2025-08-27 13:01:13] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-27 13:01:13] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-27 13:01:13] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'user_activity', 'user_avg_item_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-27 13:01:13] Всего фич после добавления: 17
[2025-08-27 13:01:13] Добавлены UI признаки: ['ui_count', 'ui_sum', 'ui_max', 'ui_min', 'ui_mean', 'ui_days_since_last', 'ui_days_since_first']
[2025-08-27 13:01:13] TRAIN: rows=1243; target_counts={0: 830, 1: 413}
[2025-08-27 13:01:13] VAL: rows=139; target_counts={0: 93, 1: 46}
[2025-08-27 13:01:13] split_time = 2025-05-22 08:10:22 (val_days=7)
[2025-08-27 13:01:13] ✅ Данные подготовлены: train=1243, val=139
[2025-08-27 13:01:13] Размер train: 993, validation: 250
[2025-08-27 13:01:13] Признаки: 24
[2025-08-27 13:01:13] Подготовка данных для LightGBM завершена за 0:00:01.420969
[2025-08-27 13:01:13] === ДЕТАЛЬНАЯ ПРОВЕРКА FEATURE GENERATION ===
[2025-08-27 13:01:13] --- ПРОВЕРКА USER FEATURES ---
[2025-08-27 13:01:13] Пример user features для пользователя 815321:
[2025-08-27 13:01:13]   user_count: 1
[2025-08-27 13:01:13]   user_mean: 7.520386983881371
[2025-08-27 13:01:13]   user_sum: 7.520386983881371
[2025-08-27 13:01:13]   user_max: 7.520386983881371
[2025-08-27 13:01:13]   user_min: 7.520386983881371
[2025-08-27 13:01:13]   user_last_ts: 2025-02-12 19:09:39.360000
[2025-08-27 13:01:13]   user_first_ts: 2025-02-12 19:09:39.360000
[2025-08-27 13:01:13]   user_orders_count: 1
[2025-08-27 13:01:13]   user_last_order_ts: 2025-02-12 19:09:39.360000
[2025-08-27 13:01:13]   user_first_order_ts: 2025-02-12 19:09:39.360000
[2025-08-27 13:01:13]   user_days_since_last: 195
[2025-08-27 13:01:13]   user_days_since_first: 195
[2025-08-27 13:01:13]   user_days_since_last_order: 195
[2025-08-27 13:01:13] Пользователей с features: 1196
[2025-08-27 13:01:13] Пользователей с НЕнулевыми features: 1196
[2025-08-27 13:01:13] --- ПРОВЕРКА ITEM FEATURES ---
[2025-08-27 13:01:13] Пример item features для товара 2160886:
[2025-08-27 13:01:13]   item_count: 2
[2025-08-27 13:01:13]   item_mean: 7.342755472756465
[2025-08-27 13:01:13]   item_sum: 14.68551094551293
[2025-08-27 13:01:13]   item_max: 8.817942961306793
[2025-08-27 13:01:13]   item_min: 5.867567984206136
[2025-08-27 13:01:13]   item_last_ts: 2025-03-22 13:27:59.943000
[2025-08-27 13:01:13]   item_first_ts: 2025-01-04 00:36:20.120000
[2025-08-27 13:01:13]   item_orders_count: 2
[2025-08-27 13:01:13]   item_category: None
[2025-08-27 13:01:13]   item_days_since_last: 157
[2025-08-27 13:01:13]   item_days_since_first: 235
[2025-08-27 13:01:13] Товаров с features: 208
[2025-08-27 13:01:13] Товаров с НЕнулевыми features: 208
[2025-08-27 13:01:13] --- ПРОВЕРКА UI FEATURES ---
[2025-08-27 13:01:13] UI features files: 2
[2025-08-27 13:01:13] UI features stats: {}
[2025-08-27 13:01:13] --- ПРОВЕРКА ЭМБЕДДИНГОВ ---
[2025-08-27 13:01:13] Пример эмбеддинга для товара 400301: shape (512,)
[2025-08-27 13:01:13] Эмбеддингов загружено: 990
[2025-08-27 13:01:13] Пример значений: [ 0.32023853  0.11766258 -0.784552    0.4168199  -0.24610527]
[2025-08-27 13:01:13] --- ПРОВЕРКА CO-PURCHASE MAP ---
[2025-08-27 13:01:13] Пример co-purchase для товара 10126067: 1 товаров
[2025-08-27 13:01:13] Co-purchase записей: 3
[2025-08-27 13:01:13] --- ПРОВЕРКА КАТЕГОРИЙНЫХ МАППИНГОВ ---
[2025-08-27 13:01:13] Товар 400301 -> категория 17080
[2025-08-27 13:01:13] Категория 17080 -> 4 товаров
[2025-08-27 13:01:13] Товаров в маппинге: 990
[2025-08-27 13:01:13] Категорий в маппинге: 223
[2025-08-27 13:01:13] Проверка признаков завершена за 0:00:00.001550
[2025-08-27 13:01:13] === ОБУЧЕНИЕ LightGBM ===
[2025-08-27 13:01:13] Размер train: 993
[2025-08-27 13:01:13] Размер val: 250
[2025-08-27 13:01:13] NDCG@100 на валидации: 0.5063
[2025-08-27 13:01:13] Обучение LightGBM завершено за 0:00:00.070991
[2025-08-27 13:01:13] === ОЦЕНКА МОДЕЛИ ===
[2025-08-27 13:01:13] NDCG@100 train: 0.4980
[2025-08-27 13:01:13] NDCG@100 val: 0.5063
[2025-08-27 13:01:13] Оценка модели завершена за 0:00:00.038323
[2025-08-27 13:01:13] === ВАЖНОСТЬ ПРИЗНАКОВ ===
[2025-08-27 13:01:13] Топ-20 важных признаков:
[2025-08-27 13:01:13]   item_popularity: 575
[2025-08-27 13:01:13]   user_avg_item_popularity: 442
[2025-08-27 13:01:13]   ui_sum: 289
[2025-08-27 13:01:13]   user_activity: 121
[2025-08-27 13:01:13]   ui_max: 89
[2025-08-27 13:01:13]   ui_days_since_last: 85
[2025-08-27 13:01:13]   ui_min: 78
[2025-08-27 13:01:13]   ui_count: 55
[2025-08-27 13:01:13]   fclip_embed_5: 23
[2025-08-27 13:01:13]   ui_days_since_first: 22
[2025-08-27 13:01:13]   fclip_embed_0: 21
[2025-08-27 13:01:13]   fclip_embed_8: 17
[2025-08-27 13:01:13]   ui_mean: 16
[2025-08-27 13:01:13]   fclip_embed_9: 13
[2025-08-27 13:01:13]   fclip_embed_4: 12
[2025-08-27 13:01:13]   fclip_embed_3: 9
[2025-08-27 13:01:13]   fclip_embed_2: 6
[2025-08-27 13:01:13]   fclip_embed_7: 6
[2025-08-27 13:01:13]   fclip_embed_6: 5
[2025-08-27 13:01:13]   fclip_embed_1: 3
[2025-08-27 13:01:13] Анализ важности признаков завершен за 0:00:00.001702
[2025-08-27 13:01:13] === СОХРАНЕНИЕ МОДЕЛИ И ПРИЗНАКОВ ===
[2025-08-27 13:01:13] Сохранение модели завершено за 0:00:00.003433
[2025-08-27 13:01:13] Модель сохранена в: /home/root6/python/e_cup/rec_system/src/models/lgbm_model_full.pkl
[2025-08-27 13:01:13] === ОБУЧЕНИЕ И ПРЕДСКАЗАНИЯ ЗАВЕРШЕНЫ УСПЕШНО ===
[2025-08-27 13:01:13] Общее время выполнения: 0:00:07.188947
[2025-08-27 13:01:13] Пользователей: 1195
[2025-08-27 13:01:13] Товаров: 207
[2025-08-27 13:01:13] Признаков: 24
[2025-08-27 13:01:13] NDCG@100 train: 0.4980
[2025-08-27 13:01:13] NDCG@100 val: 0.5063
[2025-08-27 13:01:13] === СИСТЕМНАЯ ИНФОРМАЦИЯ ===
[2025-08-27 13:01:13] Видеокарта: NVIDIA GeForce RTX 4090
[2025-08-27 13:01:13] Память GPU: 24.0 GB
[2025-08-27 13:01:13] Процессор: 11.2% загрузки
[2025-08-27 13:01:13] Ядра CPU: 32
[2025-08-27 13:01:13] Частота CPU: 2995.2 MHz
[2025-08-27 13:01:13] Оперативная память: 94.2 GB всего, 6.9 GB использовано
[2025-08-27 13:01:13] Частота RAM: информация требует дополнительных библиотек
[2025-08-27 13:01:13] ==========================================
[2025-08-27 13:01:13] ВСЕ ЭТАПЫ ВЫПОЛНЕНЫ УСПЕШНО!
[2025-08-27 13:01:13] ==========================================

=== ОБЩЕЕ ВРЕМЯ ВЫПОЛНЕНИЯ: 0:00:07.189898 ===
