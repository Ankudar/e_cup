=== НАЧАЛО ОБУЧЕНИЯ 2025-08-26 14:33:02 ===

[2025-08-26 14:33:02] === РЕЖИМ МАСШТАБИРОВАНИЯ: FULL ===
[2025-08-26 14:33:02] Пользователей: все
[2025-08-26 14:33:02] Данных: 100.0%
[2025-08-26 14:33:02] === ЗАГРУЗКА ДАННЫХ ===
[2025-08-26 14:33:02] Загружаем данные...
[2025-08-26 14:33:02] orders: 100,000 строк (использовано 28 из 28 партиций), ~2.0 MB
[2025-08-26 14:33:03] tracker: 100,000 строк (использовано 298 из 298 партиций), ~3.2 MB
[2025-08-26 14:33:04] items: 100,000 строк (использовано 200 из 200 партиций), ~7.4 MB
[2025-08-26 14:33:04] categories: 7,012 строк (использовано 1 из 1 партиций), ~1.7 MB
[2025-08-26 14:33:04] test_users: 100,000 строк (использовано 1 из 1 партиций), ~0.4 MB
[2025-08-26 14:33:04] Данные загружены
[2025-08-26 14:33:04] Фильтрация данных...
[2025-08-26 14:33:04] Фильтрация завершена
[2025-08-26 14:33:04] Загрузка данных завершена за 0:00:02.089525
[2025-08-26 14:33:04] === ЗАГРУЗКА ЭМБЕДДИНГОВ ===
[2025-08-26 14:33:04] Оптимизированная потоковая загрузка эмбеддингов...
[2025-08-26 14:33:05] Загружено эмбеддингов для 43059 товаров
[2025-08-26 14:33:05] Загрузка эмбеддингов завершена за 0:00:00.893226
[2025-08-26 14:33:05] Загружено эмбеддингов: 43059
[2025-08-26 14:33:05] === SPLIT ДАННЫХ ===
[2025-08-26 14:33:05] Split данных завершен за 0:00:00.035437
[2025-08-26 14:33:05] Train orders: 37867, Test orders: 9461
[2025-08-26 14:33:05] === ПОДГОТОВКА ВЗАИМОДЕЙСТВИЙ ===
[2025-08-26 14:33:05] Формируем матрицу взаимодействий по батчам...
[2025-08-26 14:33:05] ... для orders
[2025-08-26 14:33:05] Сохранен orders-батч 0-37867
[2025-08-26 14:33:05] ... для tracker
[2025-08-26 14:33:07] Сохранен tracker-партиция 0
[2025-08-26 14:33:07] Все батчи сохранены на диск.
[2025-08-26 14:33:07] Подготовка взаимодействий завершена за 0:00:01.979762
[2025-08-26 14:33:07] Создано файлов взаимодействий: 2
[2025-08-26 14:33:07] === ПОСЛЕДНИЕ ТОВАРЫ ===
[2025-08-26 14:33:07] Построение recent items map завершено за 0:00:00.051677
[2025-08-26 14:33:07] Пользователей с recent items: 67165
[2025-08-26 14:33:07] === ОБУЧЕНИЕ ALS ДЛЯ ПРИЗНАКОВ ===
[2025-08-26 14:33:07] Первый проход: построение маппингов...
[2025-08-26 14:33:07] Маппинги построены. Уников: users=67165, items=33018
[2025-08-26 14:33:07] Сохранение батчей на диск...
[2025-08-26 14:33:07] Постепенное обучение...
[2025-08-26 14:33:08] Очистка временных файлов...
[2025-08-26 14:33:08] Директория батчей удалена
[2025-08-26 14:33:08] Обучение завершено!
[2025-08-26 14:33:08] Считаем глобальную популярность на основе тренировочных данных...
[2025-08-26 14:33:08] Глобальная популярность рассчитана на 37861 тренировочных заказах
[2025-08-26 14:33:08] Обучение ALS завершено за 0:00:01.040405
[2025-08-26 14:33:08] Пользователей: 67165, Товаров: 33018
[2025-08-26 14:33:08] === ПОСТРОЕНИЕ ДОПОЛНИТЕЛЬНЫХ ДАННЫХ ===
[2025-08-26 14:33:08] Строим co-purchase матрицу для топ-N товаров...
[2025-08-26 14:33:08] Топ-32739 популярных товаров определены
[2025-08-26 14:33:08] Обрабатываем 4229 корзин с популярными товарами
[2025-08-26 14:33:08] Уникальных популярных товаров: 32739
[2025-08-26 14:33:08] Создаем sparse матрицу из 21600 взаимодействий...
[2025-08-26 14:33:08] Sparse матрица построена: torch.Size([32739, 32739]), ненулевых элементов: 21438
[2025-08-26 14:33:08] Формируем рекомендации...
[2025-08-26 14:33:21] Co-purchase словарь построен для 10097 товаров
[2025-08-26 14:33:21] В среднем 2.1 рекомендаций на товар
[2025-08-26 14:33:21] Co-purchase map построен: 10097 товаров
[2025-08-26 14:33:21] Построение категорийных маппингов...
[2025-08-26 14:33:21] Категорийные маппинги построены: 63318 товаров, 419 категорий
[2025-08-26 14:33:21] Построение дополнительных данных завершено за 0:00:13.376698
[2025-08-26 14:33:21] === ПРЕДВАРИТЕЛЬНЫЙ РАСЧЕТ ПРИЗНАКОВ ДЛЯ LGBM ===
[2025-08-26 14:33:21] Построение словаря пользовательских признаков...
[2025-08-26 14:33:21] Агрегация по заказам...
[2025-08-26 14:33:22] Словарь пользовательских признаков построен. Записей: 67166
[2025-08-26 14:33:22] User features построены за 0:00:00.228495: 67166 пользователей
[2025-08-26 14:33:22] Построение словаря товарных признаков...
[2025-08-26 14:33:22] Добавление данных из items_df...
[2025-08-26 14:33:22] Добавление эмбеддингов...
[2025-08-26 14:33:22] Словарь товарных признаков построен. Записей: 33019
[2025-08-26 14:33:22] Item features построены за 0:00:00.382656: 33019 товаров
[2025-08-26 14:33:22] Создание UI-признаков (данные остаются на диске)
[2025-08-26 14:33:22] Создано 2 файлов UI-признаков в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-26 14:33:22] User-Item features созданы в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-26 14:33:22] Количество файлов: 2
[2025-08-26 14:33:22] User-Item features построены за 0:00:00.020805
[2025-08-26 14:33:22] Предварительный расчет признаков завершен за 0:00:00.632237
[2025-08-26 14:33:22] === ПОДГОТОВКА ДАННЫХ ДЛЯ LightGBM ===
[2025-08-26 14:33:22] Подготовка данных для LightGBM (streaming)...
[2025-08-26 14:34:08] Добавление богатых признаков...
[2025-08-26 14:34:08] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-26 14:34:11] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-26 14:34:11] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-26 14:34:11] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-26 14:34:11] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-26 14:34:11] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-26 14:34:11] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-26 14:34:11] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-26 14:34:11] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-26 14:34:11] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-26 14:34:11] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-26 14:34:11] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-26 14:34:11] Всего фич после добавления: 15
[2025-08-26 14:34:11] Добавление богатых признаков...
[2025-08-26 14:34:11] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-26 14:34:15] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-26 14:34:15] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-26 14:34:15] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-26 14:34:15] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-26 14:34:15] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-26 14:34:15] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-26 14:34:15] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-26 14:34:15] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-26 14:34:15] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-26 14:34:15] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-26 14:34:15] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-26 14:34:15] Всего фич после добавления: 15
[2025-08-26 14:34:15] Добавлены UI признаки: ['ui_count', 'ui_sum', 'ui_max', 'ui_min', 'ui_mean', 'ui_days_since_last', 'ui_days_since_first']
[2025-08-26 14:34:15] TRAIN: rows=100858; target_counts={0: 79167, 1: 21691}
[2025-08-26 14:34:15] VAL: rows=11207; target_counts={0: 8808, 1: 2399}
[2025-08-26 14:34:15] split_time = 2025-06-25 20:19:58.763000 (val_days=7)
[2025-08-26 14:34:15] ✅ Данные подготовлены: train=100858, val=11207
[2025-08-26 14:34:15] Размер train: 80553, validation: 20305
[2025-08-26 14:34:15] Признаки: 22
[2025-08-26 14:34:15] Подготовка данных для LightGBM завершена за 0:00:53.175276
[2025-08-26 14:34:15] === ОБУЧЕНИЕ LightGBM ===
[2025-08-26 14:34:15] Размер тренировочных данных: 80553
[2025-08-26 14:34:15] Количество групп: 21663
[2025-08-26 14:34:15] Начинаем обучение LightGBM...
[2025-08-26 14:34:22] Обучение LightGBM завершено за 0:00:06.403734
[2025-08-26 14:34:22] === ОЦЕНКА МОДЕЛИ ===
[2025-08-26 14:34:22] NDCG@100 train: 0.6338
[2025-08-26 14:34:22] NDCG@100 val: 0.6243
[2025-08-26 14:34:22] Оценка модели завершена за 0:00:00.752788
[2025-08-26 14:34:22] === ВАЖНОСТЬ ПРИЗНАКОВ ===
[2025-08-26 14:34:22] Топ-20 важных признаков:
[2025-08-26 14:34:22]   item_popularity: 18
[2025-08-26 14:34:22]   fclip_embed_4: 2
[2025-08-26 14:34:22]   ui_count: 2
[2025-08-26 14:34:22]   fclip_embed_7: 2
[2025-08-26 14:34:22]   fclip_embed_3: 2
[2025-08-26 14:34:22]   fclip_embed_1: 1
[2025-08-26 14:34:22]   fclip_embed_0: 0
[2025-08-26 14:34:22]   covisitation_score: 0
[2025-08-26 14:34:22]   category_popularity: 0
[2025-08-26 14:34:22]   hour: 0
[2025-08-26 14:34:22]   is_weekend: 0
[2025-08-26 14:34:22]   fclip_embed_2: 0
[2025-08-26 14:34:22]   fclip_embed_6: 0
[2025-08-26 14:34:22]   fclip_embed_5: 0
[2025-08-26 14:34:22]   fclip_embed_8: 0
[2025-08-26 14:34:22]   fclip_embed_9: 0
[2025-08-26 14:34:22]   ui_sum: 0
[2025-08-26 14:34:22]   ui_max: 0
[2025-08-26 14:34:22]   ui_min: 0
[2025-08-26 14:34:22]   ui_mean: 0
[2025-08-26 14:34:22] Анализ важности признаков завершен за 0:00:00.001796
[2025-08-26 14:34:22] === СОХРАНЕНИЕ МОДЕЛИ И ПРИЗНАКОВ ===
[2025-08-26 14:34:23] Сохранение модели завершено за 0:00:00.211615
[2025-08-26 14:34:23] Модель сохранена в: /home/root6/python/e_cup/rec_system/src/models/lgbm_model_full.pkl
[2025-08-26 14:34:23] === ОБУЧЕНИЕ ЗАВЕРШЕНО УСПЕШНО ===
[2025-08-26 14:34:23] Общее время выполнения: 0:01:20.645799
[2025-08-26 14:34:23] Пользователей: 67165
[2025-08-26 14:34:23] Товаров: 33018
[2025-08-26 14:34:23] Признаков: 22
[2025-08-26 14:34:23] NDCG@100 train: 0.6338
[2025-08-26 14:34:23] NDCG@100 val: 0.6243
[2025-08-26 14:34:23] === СИСТЕМНАЯ ИНФОРМАЦИЯ ===
[2025-08-26 14:34:23] Видеокарта: NVIDIA GeForce RTX 4090
[2025-08-26 14:34:23] Память GPU: 24.0 GB
[2025-08-26 14:34:23] Процессор: 16.7% загрузки
[2025-08-26 14:34:23] Ядра CPU: 32
[2025-08-26 14:34:23] Частота CPU: 2995.2 MHz
[2025-08-26 14:34:23] Оперативная память: 94.2 GB всего, 7.5 GB использовано
[2025-08-26 14:34:23] Частота RAM: информация требует дополнительных библиотек
[2025-08-26 14:34:23] ==========================================
[2025-08-26 14:34:23] ВСЕ ЭТАПЫ ВЫПОЛНЕНЫ УСПЕШНО!
[2025-08-26 14:34:23] ==========================================

=== ОБЩЕЕ ВРЕМЯ ВЫПОЛНЕНИЯ: 0:01:20.646799 ===
