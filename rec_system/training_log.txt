=== НАЧАЛО ОБУЧЕНИЯ 2025-08-26 18:48:26 ===

[2025-08-26 18:48:26] === РЕЖИМ МАСШТАБИРОВАНИЯ: FULL ===
[2025-08-26 18:48:26] Пользователей: все
[2025-08-26 18:48:26] Данных: 100.0%
[2025-08-26 18:48:26] === ЗАГРУЗКА ДАННЫХ ===
[2025-08-26 18:48:26] Загружаем данные...
[2025-08-26 18:48:26] orders: 100,000 строк (использовано 28 из 28 партиций), ~2.0 MB
[2025-08-26 18:48:27] tracker: 100,000 строк (использовано 298 из 298 партиций), ~3.2 MB
[2025-08-26 18:48:28] items: 100,000 строк (использовано 200 из 200 партиций), ~7.4 MB
[2025-08-26 18:48:28] categories: 7,012 строк (использовано 1 из 1 партиций), ~1.7 MB
[2025-08-26 18:48:28] test_users: 100,000 строк (использовано 1 из 1 партиций), ~0.4 MB
[2025-08-26 18:48:28] Данные загружены
[2025-08-26 18:48:28] Фильтрация данных...
[2025-08-26 18:48:28] Фильтрация завершена
[2025-08-26 18:48:28] Загрузка данных завершена за 0:00:01.797530
[2025-08-26 18:48:28] === ЗАГРУЗКА ЭМБЕДДИНГОВ ===
[2025-08-26 18:48:28] Оптимизированная потоковая загрузка эмбеддингов...
[2025-08-26 18:48:29] Загружено эмбеддингов для 43059 товаров
[2025-08-26 18:48:29] Загрузка эмбеддингов завершена за 0:00:00.833145
[2025-08-26 18:48:29] Загружено эмбеддингов: 43059
[2025-08-26 18:48:29] === SPLIT ДАННЫХ ===
[2025-08-26 18:48:29] Split данных завершен за 0:00:00.033437
[2025-08-26 18:48:29] Train orders: 37867, Test orders: 9461
[2025-08-26 18:48:29] === ПОДГОТОВКА ВЗАИМОДЕЙСТВИЙ ===
[2025-08-26 18:48:29] Формируем матрицу взаимодействий по батчам...
[2025-08-26 18:48:29] ... для orders
[2025-08-26 18:48:29] Сохранен orders-батч 0-37867
[2025-08-26 18:48:29] ... для tracker
[2025-08-26 18:48:30] Сохранен tracker-партиция 0
[2025-08-26 18:48:30] Все батчи сохранены на диск.
[2025-08-26 18:48:30] Подготовка взаимодействий завершена за 0:00:00.899363
[2025-08-26 18:48:30] Создано файлов взаимодействий: 2
[2025-08-26 18:48:30] === ПОСЛЕДНИЕ ТОВАРЫ ===
[2025-08-26 18:48:30] Построение recent items map завершено за 0:00:00.053611
[2025-08-26 18:48:30] Пользователей с recent items: 67165
[2025-08-26 18:48:30] === ОБУЧЕНИЕ ALS ДЛЯ ПРИЗНАКОВ ===
[2025-08-26 18:48:30] Первый проход: построение маппингов...
[2025-08-26 18:48:30] Маппинги построены. Уников: users=67165, items=33018
[2025-08-26 18:48:30] Сохранение батчей на диск...
[2025-08-26 18:48:30] Постепенное обучение...
[2025-08-26 18:48:30] Очистка временных файлов...
[2025-08-26 18:48:30] Директория батчей удалена
[2025-08-26 18:48:30] Обучение завершено!
[2025-08-26 18:48:30] Считаем глобальную популярность на основе тренировочных данных...
[2025-08-26 18:48:30] Глобальная популярность рассчитана на 37861 тренировочных заказах
[2025-08-26 18:48:30] Обучение ALS завершено за 0:00:00.902085
[2025-08-26 18:48:30] Пользователей: 67165, Товаров: 33018
[2025-08-26 18:48:30] === ПОСТРОЕНИЕ ДОПОЛНИТЕЛЬНЫХ ДАННЫХ ===
[2025-08-26 18:48:30] Строим co-purchase матрицу для топ-N товаров...
[2025-08-26 18:48:30] Топ-1000 популярных товаров определены
[2025-08-26 18:48:31] Обрабатываем 165 корзин с популярными товарами
[2025-08-26 18:48:31] Уникальных популярных товаров: 1000
[2025-08-26 18:48:31] Создаем sparse матрицу из 396 взаимодействий...
[2025-08-26 18:48:31] Sparse матрица построена: torch.Size([1000, 1000]), ненулевых элементов: 308
[2025-08-26 18:48:31] Формируем рекомендации...
[2025-08-26 18:48:31] Co-purchase словарь построен для 219 товаров
[2025-08-26 18:48:31] В среднем 1.4 рекомендаций на товар
[2025-08-26 18:48:31] Co-purchase map построен: 219 товаров
[2025-08-26 18:48:31] Построение категорийных маппингов...
[2025-08-26 18:48:31] Категорийные маппинги построены: 63318 товаров, 419 категорий
[2025-08-26 18:48:31] Построение дополнительных данных завершено за 0:00:00.720232
[2025-08-26 18:48:31] === ПРЕДВАРИТЕЛЬНЫЙ РАСЧЕТ ПРИЗНАКОВ ДЛЯ LGBM ===
[2025-08-26 18:48:31] Построение словаря пользовательских признаков...
[2025-08-26 18:48:31] Агрегация по заказам...
[2025-08-26 18:48:31] Словарь пользовательских признаков построен. Записей: 67166
[2025-08-26 18:48:31] User features построены за 0:00:00.191771: 67166 пользователей
[2025-08-26 18:48:31] Построение словаря товарных признаков...
[2025-08-26 18:48:31] Добавление данных из items_df...
[2025-08-26 18:48:32] Добавление эмбеддингов...
[2025-08-26 18:48:32] Словарь товарных признаков построен. Записей: 33019
[2025-08-26 18:48:32] Item features построены за 0:00:00.322427: 33019 товаров
[2025-08-26 18:48:32] Создание UI-признаков (данные остаются на диске)
[2025-08-26 18:48:32] Создано 2 файлов UI-признаков в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-26 18:48:32] User-Item features созданы в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-26 18:48:32] Количество файлов: 2
[2025-08-26 18:48:32] User-Item features построены за 0:00:00.025542
[2025-08-26 18:48:32] Предварительный расчет признаков завершен за 0:00:00.539997
[2025-08-26 18:48:32] === ПОДГОТОВКА ДАННЫХ ДЛЯ LightGBM ===
[2025-08-26 18:48:32] Подготовка данных для LightGBM (streaming)...
[2025-08-26 18:49:26] Обучение матрицы ковизитации на train данных...
[2025-08-26 18:49:27] Размер матрицы ковизитации: 0 товаров
[2025-08-26 18:49:27] Добавление фичей для train данных...
[2025-08-26 18:49:27] Добавление богатых признаков...
[2025-08-26 18:49:27] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-26 18:49:29] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-26 18:49:29] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-26 18:49:29] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-26 18:49:29] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-26 18:49:29] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-26 18:49:29] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-26 18:49:29] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-26 18:49:29] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-26 18:49:29] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-26 18:49:29] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-26 18:49:29] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'user_activity', 'user_avg_item_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-26 18:49:29] Всего фич после добавления: 17
[2025-08-26 18:49:29] Добавление фичей для val данных (на основе train статистик)...
[2025-08-26 18:49:29] Добавление богатых признаков...
[2025-08-26 18:49:29] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-26 18:49:31] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-26 18:49:31] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-26 18:49:31] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-26 18:49:31] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-26 18:49:31] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-26 18:49:31] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-26 18:49:31] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-26 18:49:31] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-26 18:49:31] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-26 18:49:31] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-26 18:49:31] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'user_activity', 'user_avg_item_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-26 18:49:31] Всего фич после добавления: 17
[2025-08-26 18:49:31] Добавлены UI признаки: ['ui_count', 'ui_sum', 'ui_max', 'ui_min', 'ui_mean', 'ui_days_since_last', 'ui_days_since_first']
[2025-08-26 18:49:31] TRAIN: rows=100858; target_counts={0: 79167, 1: 21691}
[2025-08-26 18:49:31] VAL: rows=11207; target_counts={0: 8808, 1: 2399}
[2025-08-26 18:49:31] split_time = 2025-06-25 20:19:58.763000 (val_days=7)
[2025-08-26 18:49:31] ✅ Данные подготовлены: train=100858, val=11207
[2025-08-26 18:49:31] Размер train: 80553, validation: 20305
[2025-08-26 18:49:31] Признаки: 24
[2025-08-26 18:49:31] Подготовка данных для LightGBM завершена за 0:00:59.572063
[2025-08-26 18:49:31] === ОБУЧЕНИЕ LightGBM ===
[2025-08-26 18:49:31] Размер тренировочных данных: 80553
[2025-08-26 18:49:31] Размер валидационных данных: 20305
[2025-08-26 18:49:33] Обучение LightGBM завершено за 0:00:01.640590
[2025-08-26 18:49:33] === ОЦЕНКА МОДЕЛИ ===
[2025-08-26 18:49:45] NDCG@100 train: 0.6213
[2025-08-26 18:49:45] NDCG@100 val: 0.6101
[2025-08-26 18:49:45] Оценка модели завершена за 0:00:11.669991
[2025-08-26 18:49:45] === ВАЖНОСТЬ ПРИЗНАКОВ ===
[2025-08-26 18:49:45] Топ-20 важных признаков:
[2025-08-26 18:49:45]   user_avg_item_popularity: 1804
[2025-08-26 18:49:45]   item_popularity: 1124
[2025-08-26 18:49:45]   user_activity: 1085
[2025-08-26 18:49:45]   ui_count: 329
[2025-08-26 18:49:45]   fclip_embed_2: 167
[2025-08-26 18:49:45]   fclip_embed_6: 141
[2025-08-26 18:49:45]   fclip_embed_9: 137
[2025-08-26 18:49:45]   fclip_embed_7: 126
[2025-08-26 18:49:45]   fclip_embed_1: 123
[2025-08-26 18:49:45]   fclip_embed_0: 121
[2025-08-26 18:49:45]   fclip_embed_3: 113
[2025-08-26 18:49:45]   ui_days_since_last: 110
[2025-08-26 18:49:45]   fclip_embed_5: 108
[2025-08-26 18:49:45]   fclip_embed_4: 105
[2025-08-26 18:49:45]   fclip_embed_8: 96
[2025-08-26 18:49:45]   ui_sum: 60
[2025-08-26 18:49:45]   ui_days_since_first: 36
[2025-08-26 18:49:45]   ui_max: 3
[2025-08-26 18:49:45]   hour: 0
[2025-08-26 18:49:45]   category_popularity: 0
[2025-08-26 18:49:45] Анализ важности признаков завершен за 0:00:00.001719
[2025-08-26 18:49:45] === СОХРАНЕНИЕ МОДЕЛИ И ПРИЗНАКОВ ===
[2025-08-26 18:49:45] Сохранение модели завершено за 0:00:00.210302
[2025-08-26 18:49:45] Модель сохранена в: /home/root6/python/e_cup/rec_system/src/models/lgbm_model_full.pkl
[2025-08-26 18:49:45] === ОБУЧЕНИЕ ЗАВЕРШЕНО УСПЕШНО ===
[2025-08-26 18:49:45] Общее время выполнения: 0:01:18.875754
[2025-08-26 18:49:45] Пользователей: 67165
[2025-08-26 18:49:45] Товаров: 33018
[2025-08-26 18:49:45] Признаков: 24
[2025-08-26 18:49:45] NDCG@100 train: 0.6213
[2025-08-26 18:49:45] NDCG@100 val: 0.6101
[2025-08-26 18:49:45] === СИСТЕМНАЯ ИНФОРМАЦИЯ ===
[2025-08-26 18:49:45] Видеокарта: NVIDIA GeForce RTX 4090
[2025-08-26 18:49:45] Память GPU: 24.0 GB
[2025-08-26 18:49:45] Процессор: 11.6% загрузки
[2025-08-26 18:49:45] Ядра CPU: 32
[2025-08-26 18:49:45] Частота CPU: 2995.2 MHz
[2025-08-26 18:49:45] Оперативная память: 94.2 GB всего, 6.0 GB использовано
[2025-08-26 18:49:45] Частота RAM: информация требует дополнительных библиотек
[2025-08-26 18:49:45] ==========================================
[2025-08-26 18:49:45] ВСЕ ЭТАПЫ ВЫПОЛНЕНЫ УСПЕШНО!
[2025-08-26 18:49:45] ==========================================

=== ОБЩЕЕ ВРЕМЯ ВЫПОЛНЕНИЯ: 0:01:18.876789 ===
