=== НАЧАЛО ОБУЧЕНИЯ 2025-08-26 09:55:57 ===

[2025-08-26 09:55:57] === РЕЖИМ МАСШТАБИРОВАНИЯ: FULL ===
[2025-08-26 09:55:57] Пользователей: все
[2025-08-26 09:55:57] Данных: 100.0%
[2025-08-26 09:55:57] === ЗАГРУЗКА ДАННЫХ ===
[2025-08-26 09:55:57] Загружаем данные...
[2025-08-26 09:55:57] orders: 1,000,000 строк (использовано 28 из 28 партиций), ~2.0 MB
[2025-08-26 09:55:58] tracker: 1,000,000 строк (использовано 298 из 298 партиций), ~32.3 MB
[2025-08-26 09:55:58] items: 1,000,000 строк (использовано 200 из 200 партиций), ~7.4 MB
[2025-08-26 09:55:59] categories: 7,012 строк (использовано 1 из 1 партиций), ~1.7 MB
[2025-08-26 09:55:59] test_users: 470,347 строк (использовано 1 из 1 партиций), ~1.8 MB
[2025-08-26 09:55:59] Данные загружены
[2025-08-26 09:55:59] Фильтрация данных...
[2025-08-26 09:55:59] Фильтрация завершена
[2025-08-26 09:55:59] Загрузка данных завершена за 0:00:01.875729
[2025-08-26 09:55:59] === ЗАГРУЗКА ЭМБЕДДИНГОВ ===
[2025-08-26 09:55:59] Оптимизированная потоковая загрузка эмбеддингов...
[2025-08-26 09:55:59] Загружено эмбеддингов для 43059 товаров
[2025-08-26 09:55:59] Загрузка эмбеддингов завершена за 0:00:00.882275
[2025-08-26 09:55:59] Загружено эмбеддингов: 43059
[2025-08-26 09:55:59] === SPLIT ДАННЫХ ===
[2025-08-26 09:55:59] Split данных завершен за 0:00:00.020606
[2025-08-26 09:55:59] Train orders: 19306, Test orders: 4826
[2025-08-26 09:55:59] === ПОДГОТОВКА ВЗАИМОДЕЙСТВИЙ ===
[2025-08-26 09:55:59] Формируем матрицу взаимодействий по батчам...
[2025-08-26 09:55:59] ... для orders
[2025-08-26 09:56:00] Сохранен orders-батч 0-19306
[2025-08-26 09:56:00] ... для tracker
[2025-08-26 09:56:01] Сохранен tracker-партиция 0
[2025-08-26 09:56:01] Все батчи сохранены на диск.
[2025-08-26 09:56:01] Подготовка взаимодействий завершена за 0:00:01.062166
[2025-08-26 09:56:01] Создано файлов взаимодействий: 2
[2025-08-26 09:56:01] === ПОСЛЕДНИЕ ТОВАРЫ ===
[2025-08-26 09:56:01] Построение recent items map завершено за 0:00:00.337003
[2025-08-26 09:56:01] Пользователей с recent items: 286097
[2025-08-26 09:56:01] === ОБУЧЕНИЕ ALS ДЛЯ ПРИЗНАКОВ ===
[2025-08-26 09:56:01] Первый проход: построение маппингов...
[2025-08-26 09:56:01] Маппинги построены. Уников: users=286097, items=19808
[2025-08-26 09:56:01] Сохранение батчей на диск...
[2025-08-26 09:56:01] Постепенное обучение...
[2025-08-26 09:56:02] Очистка временных файлов...
[2025-08-26 09:56:02] Директория батчей удалена
[2025-08-26 09:56:02] Обучение завершено!
[2025-08-26 09:56:02] Считаем глобальную популярность на основе тренировочных данных...
[2025-08-26 09:56:02] Глобальная популярность рассчитана на 19305 тренировочных заказах
[2025-08-26 09:56:02] Обучение ALS завершено за 0:00:00.984309
[2025-08-26 09:56:02] Пользователей: 286097, Товаров: 19808
[2025-08-26 09:56:02] === ПОСТРОЕНИЕ ДОПОЛНИТЕЛЬНЫХ ДАННЫХ ===
[2025-08-26 09:56:02] Строим co-purchase матрицу для топ-N товаров...
[2025-08-26 09:56:02] Топ-16885 популярных товаров определены
[2025-08-26 09:56:02] Обрабатываем 1376 корзин с популярными товарами
[2025-08-26 09:56:02] Уникальных популярных товаров: 16885
[2025-08-26 09:56:02] Создаем sparse матрицу из 5052 взаимодействий...
[2025-08-26 09:56:02] Sparse матрица построена: torch.Size([16885, 16885]), ненулевых элементов: 5038
[2025-08-26 09:56:02] Формируем рекомендации...
[2025-08-26 09:56:05] Co-purchase словарь построен для 3065 товаров
[2025-08-26 09:56:05] В среднем 1.6 рекомендаций на товар
[2025-08-26 09:56:05] Co-purchase map построен: 3065 товаров
[2025-08-26 09:56:05] Построение категорийных маппингов...
[2025-08-26 09:56:05] Категорийные маппинги построены: 63318 товаров, 419 категорий
[2025-08-26 09:56:05] Построение дополнительных данных завершено за 0:00:03.103003
[2025-08-26 09:56:05] === ПРЕДВАРИТЕЛЬНЫЙ РАСЧЕТ ПРИЗНАКОВ ДЛЯ LGBM ===
[2025-08-26 09:56:05] Построение словаря пользовательских признаков...
[2025-08-26 09:56:05] Агрегация по заказам...
[2025-08-26 09:56:05] Словарь пользовательских признаков построен. Записей: 286098
[2025-08-26 09:56:05] User features построены за 0:00:00.531443: 286098 пользователей
[2025-08-26 09:56:05] Построение словаря товарных признаков...
[2025-08-26 09:56:06] Добавление данных из items_df...
[2025-08-26 09:56:06] Добавление эмбеддингов...
[2025-08-26 09:56:06] Словарь товарных признаков построен. Записей: 19809
[2025-08-26 09:56:06] Item features построены за 0:00:00.306962: 19809 товаров
[2025-08-26 09:56:06] Создание UI-признаков (данные остаются на диске)
[2025-08-26 09:56:06] Создано 2 файлов UI-признаков в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-26 09:56:06] User-Item features созданы в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-26 09:56:06] Количество файлов: 2
[2025-08-26 09:56:06] User-Item features построены за 0:00:00.054157
[2025-08-26 09:56:06] Предварительный расчет признаков завершен за 0:00:00.892818
[2025-08-26 09:56:06] === ПОДГОТОВКА ДАННЫХ ДЛЯ LightGBM ===
[2025-08-26 09:56:06] Подготовка данных для LightGBM...
[2025-08-26 09:56:23] Saved final negative shard: /home/root6/python/e_cup/rec_system/data/processed/negatives/neg_0.parquet, rows=8014
[2025-08-26 09:56:23] Добавление богатых признаков...
[2025-08-26 09:56:23] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-26 09:56:25] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-26 09:56:25] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-26 09:56:25] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-26 09:56:25] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-26 09:56:25] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-26 09:56:25] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-26 09:56:25] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-26 09:56:25] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-26 09:56:25] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-26 09:56:25] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-26 09:56:25] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-26 09:56:25] Всего фич после добавления: 15
[2025-08-26 09:56:25] Добавление богатых признаков...
[2025-08-26 09:56:25] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-26 09:56:28] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-26 09:56:28] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-26 09:56:28] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-26 09:56:28] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-26 09:56:28] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-26 09:56:28] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-26 09:56:28] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-26 09:56:28] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-26 09:56:28] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-26 09:56:28] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-26 09:56:28] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-26 09:56:28] Всего фич после добавления: 15
[2025-08-26 09:56:28] Добавлены UI признаки: ['ui_count', 'ui_sum', 'ui_max', 'ui_min', 'ui_mean', 'ui_days_since_last', 'ui_days_since_first']
[2025-08-26 09:56:28] TRAIN: rows=12840; target_counts={0: 8014, 1: 4826}
[2025-08-26 09:56:28] VAL: rows=86928; target_counts={1: 86928}
[2025-08-26 09:56:28] split_time = 2025-06-25 20:13:21.386000 (val_days=7)
[2025-08-26 09:56:28] ✅ Данные подготовлены: train=12840, val=86928
[2025-08-26 09:56:28] Размер train: 10244, validation: 2596
[2025-08-26 09:56:28] Признаки: 22
[2025-08-26 09:56:28] Подготовка данных для LightGBM завершена за 0:00:22.422428
[2025-08-26 09:56:28] === ОБУЧЕНИЕ LightGBM ===
[2025-08-26 09:56:28] Размер тренировочных данных: 10244
[2025-08-26 09:56:28] Количество групп: 3205
[2025-08-26 09:56:28] Начинаем обучение LightGBM...
[2025-08-26 09:56:29] Обучение LightGBM завершено за 0:00:01.040533
[2025-08-26 09:56:29] === ОЦЕНКА МОДЕЛИ ===
[2025-08-26 09:56:29] NDCG@100 train: 0.3757
[2025-08-26 09:56:29] NDCG@100 val: 0.3815
[2025-08-26 09:56:29] Оценка модели завершена за 0:00:00.111748
[2025-08-26 09:56:29] === ВАЖНОСТЬ ПРИЗНАКОВ ===
[2025-08-26 09:56:29] Топ-20 важных признаков:
[2025-08-26 09:56:29]   is_weekend: 0
[2025-08-26 09:56:29]   hour: 0
[2025-08-26 09:56:29]   item_popularity: 0
[2025-08-26 09:56:29]   category_popularity: 0
[2025-08-26 09:56:29]   covisitation_score: 0
[2025-08-26 09:56:29]   fclip_embed_0: 0
[2025-08-26 09:56:29]   fclip_embed_1: 0
[2025-08-26 09:56:29]   fclip_embed_2: 0
[2025-08-26 09:56:29]   fclip_embed_3: 0
[2025-08-26 09:56:29]   fclip_embed_4: 0
[2025-08-26 09:56:29]   fclip_embed_5: 0
[2025-08-26 09:56:29]   fclip_embed_6: 0
[2025-08-26 09:56:29]   fclip_embed_7: 0
[2025-08-26 09:56:29]   fclip_embed_8: 0
[2025-08-26 09:56:29]   fclip_embed_9: 0
[2025-08-26 09:56:29]   ui_count: 0
[2025-08-26 09:56:29]   ui_sum: 0
[2025-08-26 09:56:29]   ui_max: 0
[2025-08-26 09:56:29]   ui_min: 0
[2025-08-26 09:56:29]   ui_mean: 0
[2025-08-26 09:56:29] Анализ важности признаков завершен за 0:00:00.001759
[2025-08-26 09:56:29] === СОХРАНЕНИЕ МОДЕЛИ И ПРИЗНАКОВ ===
[2025-08-26 09:56:30] Сохранение модели завершено за 0:00:00.614527
[2025-08-26 09:56:30] Модель сохранена в: /home/root6/python/e_cup/rec_system/src/models/lgbm_model_full.pkl
[2025-08-26 09:56:30] === ОБУЧЕНИЕ ЗАВЕРШЕНО УСПЕШНО ===
[2025-08-26 09:56:30] Общее время выполнения: 0:00:33.350420
[2025-08-26 09:56:30] Пользователей: 286097
[2025-08-26 09:56:30] Товаров: 19808
[2025-08-26 09:56:30] Признаков: 22
[2025-08-26 09:56:30] NDCG@100 train: 0.3757
[2025-08-26 09:56:30] NDCG@100 val: 0.3815
[2025-08-26 09:56:30] === СИСТЕМНАЯ ИНФОРМАЦИЯ ===
[2025-08-26 09:56:30] Видеокарта: NVIDIA GeForce RTX 4090
[2025-08-26 09:56:30] Память GPU: 24.0 GB
[2025-08-26 09:56:30] Процессор: 16.9% загрузки
[2025-08-26 09:56:30] Ядра CPU: 32
[2025-08-26 09:56:30] Частота CPU: 2995.2 MHz
[2025-08-26 09:56:30] Оперативная память: 94.2 GB всего, 8.4 GB использовано
[2025-08-26 09:56:30] Частота RAM: информация требует дополнительных библиотек
[2025-08-26 09:56:30] ==========================================
[2025-08-26 09:56:30] ВСЕ ЭТАПЫ ВЫПОЛНЕНЫ УСПЕШНО!
[2025-08-26 09:56:30] ==========================================

=== ОБЩЕЕ ВРЕМЯ ВЫПОЛНЕНИЯ: 0:00:33.351440 ===
