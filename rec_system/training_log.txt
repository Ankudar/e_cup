=== НАЧАЛО ОБУЧЕНИЯ 2025-08-26 15:34:30 ===

[2025-08-26 15:34:30] === РЕЖИМ МАСШТАБИРОВАНИЯ: FULL ===
[2025-08-26 15:34:30] Пользователей: все
[2025-08-26 15:34:30] Данных: 100.0%
[2025-08-26 15:34:30] === ЗАГРУЗКА ДАННЫХ ===
[2025-08-26 15:34:30] Загружаем данные...
[2025-08-26 15:34:30] orders: 1,000 строк (использовано 28 из 28 партиций), ~0.0 MB
[2025-08-26 15:34:31] tracker: 1,000 строк (использовано 298 из 298 партиций), ~0.0 MB
[2025-08-26 15:34:32] items: 1,000 строк (использовано 200 из 200 партиций), ~0.2 MB
[2025-08-26 15:34:32] categories: 1,000 строк (использовано 1 из 1 партиций), ~0.2 MB
[2025-08-26 15:34:32] test_users: 1,000 строк (использовано 1 из 1 партиций), ~0.0 MB
[2025-08-26 15:34:32] Данные загружены
[2025-08-26 15:34:32] Фильтрация данных...
[2025-08-26 15:34:32] Фильтрация завершена
[2025-08-26 15:34:32] Загрузка данных завершена за 0:00:01.828165
[2025-08-26 15:34:32] === ЗАГРУЗКА ЭМБЕДДИНГОВ ===
[2025-08-26 15:34:32] Оптимизированная потоковая загрузка эмбеддингов...
[2025-08-26 15:34:33] Загружено эмбеддингов для 990 товаров
[2025-08-26 15:34:33] Загрузка эмбеддингов завершена за 0:00:00.801524
[2025-08-26 15:34:33] Загружено эмбеддингов: 990
[2025-08-26 15:34:33] === SPLIT ДАННЫХ ===
[2025-08-26 15:34:33] Split данных завершен за 0:00:00.019251
[2025-08-26 15:34:33] Train orders: 684, Test orders: 170
[2025-08-26 15:34:33] === ПОДГОТОВКА ВЗАИМОДЕЙСТВИЙ ===
[2025-08-26 15:34:33] Формируем матрицу взаимодействий по батчам...
[2025-08-26 15:34:33] ... для orders
[2025-08-26 15:34:33] Сохранен orders-батч 0-684
[2025-08-26 15:34:33] ... для tracker
[2025-08-26 15:34:34] Сохранен tracker-партиция 0
[2025-08-26 15:34:34] Все батчи сохранены на диск.
[2025-08-26 15:34:34] Подготовка взаимодействий завершена за 0:00:00.938360
[2025-08-26 15:34:34] Создано файлов взаимодействий: 2
[2025-08-26 15:34:34] === ПОСЛЕДНИЕ ТОВАРЫ ===
[2025-08-26 15:34:34] Построение recent items map завершено за 0:00:00.024705
[2025-08-26 15:34:34] Пользователей с recent items: 1183
[2025-08-26 15:34:34] === ОБУЧЕНИЕ ALS ДЛЯ ПРИЗНАКОВ ===
[2025-08-26 15:34:34] Первый проход: построение маппингов...
[2025-08-26 15:34:34] Маппинги построены. Уников: users=1183, items=606
[2025-08-26 15:34:34] Сохранение батчей на диск...
[2025-08-26 15:34:34] Постепенное обучение...
[2025-08-26 15:34:35] Очистка временных файлов...
[2025-08-26 15:34:35] Директория батчей удалена
[2025-08-26 15:34:35] Обучение завершено!
[2025-08-26 15:34:35] Считаем глобальную популярность на основе тренировочных данных...
[2025-08-26 15:34:35] Глобальная популярность рассчитана на 683 тренировочных заказах
[2025-08-26 15:34:35] Обучение ALS завершено за 0:00:00.903740
[2025-08-26 15:34:35] Пользователей: 1183, Товаров: 606
[2025-08-26 15:34:35] === ПОСТРОЕНИЕ ДОПОЛНИТЕЛЬНЫХ ДАННЫХ ===
[2025-08-26 15:34:35] Строим co-purchase матрицу для топ-N товаров...
[2025-08-26 15:34:35] Топ-603 популярных товаров определены
[2025-08-26 15:34:35] Обрабатываем 2 корзин с популярными товарами
[2025-08-26 15:34:35] Уникальных популярных товаров: 603
[2025-08-26 15:34:35] Создаем sparse матрицу из 4 взаимодействий...
[2025-08-26 15:34:35] Sparse матрица построена: torch.Size([603, 603]), ненулевых элементов: 4
[2025-08-26 15:34:35] Формируем рекомендации...
[2025-08-26 15:34:35] Co-purchase словарь построен для 4 товаров
[2025-08-26 15:34:35] В среднем 1.0 рекомендаций на товар
[2025-08-26 15:34:35] Co-purchase map построен: 4 товаров
[2025-08-26 15:34:35] Построение категорийных маппингов...
[2025-08-26 15:34:35] Категорийные маппинги построены: 990 товаров, 223 категорий
[2025-08-26 15:34:35] Построение дополнительных данных завершено за 0:00:00.361763
[2025-08-26 15:34:35] === ПРЕДВАРИТЕЛЬНЫЙ РАСЧЕТ ПРИЗНАКОВ ДЛЯ LGBM ===
[2025-08-26 15:34:35] Построение словаря пользовательских признаков...
[2025-08-26 15:34:35] Агрегация по заказам...
[2025-08-26 15:34:35] Словарь пользовательских признаков построен. Записей: 1184
[2025-08-26 15:34:35] User features построены за 0:00:00.052997: 1184 пользователей
[2025-08-26 15:34:35] Построение словаря товарных признаков...
[2025-08-26 15:34:35] Добавление данных из items_df...
[2025-08-26 15:34:35] Добавление эмбеддингов...
[2025-08-26 15:34:35] Словарь товарных признаков построен. Записей: 607
[2025-08-26 15:34:35] Item features построены за 0:00:00.045335: 607 товаров
[2025-08-26 15:34:35] Создание UI-признаков (данные остаются на диске)
[2025-08-26 15:34:35] Создано 2 файлов UI-признаков в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-26 15:34:35] User-Item features созданы в: /home/root6/python/e_cup/rec_system/data/processed/ui_features_distributed
[2025-08-26 15:34:35] Количество файлов: 2
[2025-08-26 15:34:35] User-Item features построены за 0:00:00.014880
[2025-08-26 15:34:35] Предварительный расчет признаков завершен за 0:00:00.113389
[2025-08-26 15:34:35] === ПОДГОТОВКА ДАННЫХ ДЛЯ LightGBM ===
[2025-08-26 15:34:35] Подготовка данных для LightGBM (streaming)...
[2025-08-26 15:34:36] Обучение матрицы ковизитации на train данных...
[2025-08-26 15:34:36] Размер матрицы ковизитации: 5 товаров
[2025-08-26 15:34:36] Добавление фичей для train данных...
[2025-08-26 15:34:36] Добавление богатых признаков...
[2025-08-26 15:34:36] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-26 15:34:36] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'user_activity', 'user_avg_item_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-26 15:34:36] Всего фич после добавления: 17
[2025-08-26 15:34:36] Добавление фичей для val данных (на основе train статистик)...
[2025-08-26 15:34:36] Добавление богатых признаков...
[2025-08-26 15:34:36] Ускоренная обработка FCLIP эмбеддингов на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 1/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 2/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 3/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 4/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 5/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 6/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 7/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 8/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 9/10 на GPU...
[2025-08-26 15:34:36] Обработка FCLIP измерения 10/10 на GPU...
[2025-08-26 15:34:36] Добавлены фичи: ['is_weekend', 'hour', 'item_popularity', 'category_popularity', 'user_activity', 'user_avg_item_popularity', 'covisitation_score', 'fclip_embed_0', 'fclip_embed_1', 'fclip_embed_2', 'fclip_embed_3', 'fclip_embed_4', 'fclip_embed_5', 'fclip_embed_6', 'fclip_embed_7', 'fclip_embed_8', 'fclip_embed_9']
[2025-08-26 15:34:36] Всего фич после добавления: 17
[2025-08-26 15:34:36] Добавлены UI признаки: ['ui_count', 'ui_sum', 'ui_max', 'ui_min', 'ui_mean', 'ui_days_since_last', 'ui_days_since_first']
[2025-08-26 15:34:36] TRAIN: rows=1975; target_counts={0: 1568, 1: 407}
[2025-08-26 15:34:36] VAL: rows=220; target_counts={0: 177, 1: 43}
[2025-08-26 15:34:36] split_time = 2025-06-25 19:56:09.596000 (val_days=7)
[2025-08-26 15:34:36] ✅ Данные подготовлены: train=1975, val=220
[2025-08-26 15:34:36] Размер train: 1606, validation: 369
[2025-08-26 15:34:36] Признаки: 24
[2025-08-26 15:34:36] Подготовка данных для LightGBM завершена за 0:00:00.540479
[2025-08-26 15:34:36] === ОБУЧЕНИЕ LightGBM ===
[2025-08-26 15:34:36] Размер тренировочных данных: 1606
[2025-08-26 15:34:36] Количество групп: 600
[2025-08-26 15:34:36] Начинаем обучение LightGBM...
[2025-08-26 15:34:38] Обучение LightGBM завершено за 0:00:01.913423
[2025-08-26 15:34:38] === ОЦЕНКА МОДЕЛИ ===
[2025-08-26 15:34:38] NDCG@100 train: 0.5533
[2025-08-26 15:34:38] NDCG@100 val: 0.4867
[2025-08-26 15:34:38] Оценка модели завершена за 0:00:00.046384
[2025-08-26 15:34:38] === ВАЖНОСТЬ ПРИЗНАКОВ ===
[2025-08-26 15:34:38] Топ-20 важных признаков:
[2025-08-26 15:34:38]   user_avg_item_popularity: 3
[2025-08-26 15:34:38]   item_popularity: 2
[2025-08-26 15:34:38]   ui_count: 1
[2025-08-26 15:34:38]   hour: 0
[2025-08-26 15:34:38]   category_popularity: 0
[2025-08-26 15:34:38]   user_activity: 0
[2025-08-26 15:34:38]   covisitation_score: 0
[2025-08-26 15:34:38]   is_weekend: 0
[2025-08-26 15:34:38]   fclip_embed_0: 0
[2025-08-26 15:34:38]   fclip_embed_1: 0
[2025-08-26 15:34:38]   fclip_embed_3: 0
[2025-08-26 15:34:38]   fclip_embed_2: 0
[2025-08-26 15:34:38]   fclip_embed_5: 0
[2025-08-26 15:34:38]   fclip_embed_6: 0
[2025-08-26 15:34:38]   fclip_embed_7: 0
[2025-08-26 15:34:38]   fclip_embed_4: 0
[2025-08-26 15:34:38]   fclip_embed_8: 0
[2025-08-26 15:34:38]   fclip_embed_9: 0
[2025-08-26 15:34:38]   ui_sum: 0
[2025-08-26 15:34:38]   ui_max: 0
[2025-08-26 15:34:38] Анализ важности признаков завершен за 0:00:00.002056
[2025-08-26 15:34:38] === СОХРАНЕНИЕ МОДЕЛИ И ПРИЗНАКОВ ===
[2025-08-26 15:34:38] Сохранение модели завершено за 0:00:00.009661
[2025-08-26 15:34:38] Модель сохранена в: /home/root6/python/e_cup/rec_system/src/models/lgbm_model_full.pkl
[2025-08-26 15:34:38] === ОБУЧЕНИЕ ЗАВЕРШЕНО УСПЕШНО ===
[2025-08-26 15:34:38] Общее время выполнения: 0:00:07.504433
[2025-08-26 15:34:38] Пользователей: 1183
[2025-08-26 15:34:38] Товаров: 606
[2025-08-26 15:34:38] Признаков: 24
[2025-08-26 15:34:38] NDCG@100 train: 0.5533
[2025-08-26 15:34:38] NDCG@100 val: 0.4867
[2025-08-26 15:34:38] === СИСТЕМНАЯ ИНФОРМАЦИЯ ===
[2025-08-26 15:34:38] Видеокарта: NVIDIA GeForce RTX 4090
[2025-08-26 15:34:38] Память GPU: 24.0 GB
[2025-08-26 15:34:38] Процессор: 29.8% загрузки
[2025-08-26 15:34:38] Ядра CPU: 32
[2025-08-26 15:34:38] Частота CPU: 2995.2 MHz
[2025-08-26 15:34:38] Оперативная память: 94.2 GB всего, 7.4 GB использовано
[2025-08-26 15:34:38] Частота RAM: информация требует дополнительных библиотек
[2025-08-26 15:34:38] ==========================================
[2025-08-26 15:34:38] ВСЕ ЭТАПЫ ВЫПОЛНЕНЫ УСПЕШНО!
[2025-08-26 15:34:38] ==========================================

=== ОБЩЕЕ ВРЕМЯ ВЫПОЛНЕНИЯ: 0:00:07.505465 ===
