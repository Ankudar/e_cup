=== НАЧАЛО ОБУЧЕНИЯ 2025-08-31 11:23:44 ===

[2025-08-31 11:23:44] === РЕЖИМ МАСШТАБИРОВАНИЯ: FULL ===
[2025-08-31 11:23:44] Пользователей: все
[2025-08-31 11:23:44] Данных: 100.0%
[2025-08-31 11:23:44] === ЗАГРУЗКА ДАННЫХ ===
[2025-08-31 11:23:44] Загружаем данные...
[2025-08-31 11:23:44] orders: найдено 5 файлов, используем 5
[2025-08-31 11:23:45] orders: ограничено 1,000 из 18,887,122 строк (семплирование 0.0%, использовано 5 файлов), ~0.0 MB
[2025-08-31 11:23:45] tracker: найдено 200 файлов, используем 200
[2025-08-31 11:25:49] tracker: ограничено 1,001 из 1,644,982,482 строк (семплирование 0.0%, использовано 200 файлов), ~0.0 MB
[2025-08-31 11:25:49] items: найдено 100 файлов, используем 100
[2025-08-31 11:26:01] items: ограничено 1,000 из 6,439,422 строк (семплирование 0.0%, использовано 100 файлов), ~0.2 MB
[2025-08-31 11:26:01] categories: найдено 1 файлов, используем 1
[2025-08-31 11:26:01] categories: ограничено 1,000 из 7,012 строк (семплирование 14.3%, использовано 1 файлов), ~0.2 MB
[2025-08-31 11:26:01] test_users: найдено 1 файлов, используем 1
[2025-08-31 11:26:02] test_users: ограничено 1,000 из 470,347 строк (семплирование 0.2%, использовано 1 файлов), ~0.0 MB
[2025-08-31 11:26:02] Данные загружены
[2025-08-31 11:26:02] Фильтрация данных...
[2025-08-31 11:26:02] Фильтрация завершена
[2025-08-31 11:26:02] Загрузка данных завершена за 0:02:17.876914
[2025-08-31 11:26:02] === ЗАГРУЗКА ЭМБЕДДИНГОВ ===
[2025-08-31 11:26:02] Оптимизированная потоковая загрузка эмбеддингов...
[2025-08-31 11:26:07] Загружено эмбеддингов для 1000 товаров
[2025-08-31 11:26:07] Пример ключей в embeddings_dict: [324738852, 212260458, 337314157, 240658167, 206492097]
[2025-08-31 11:26:07] Пример значения: [ 0.00533594 -0.17438558  0.20624053  0.91315746 -0.47587407]
[2025-08-31 11:26:07] Загрузка эмбеддингов завершена за 0:00:05.690259
[2025-08-31 11:26:07] Загружено эмбеддингов: 1000
[2025-08-31 11:26:07] === SPLIT ДАННЫХ ===
[2025-08-31 11:26:08] Split данных завершен за 0:00:00.912078
[2025-08-31 11:26:08] Train orders: 764, Test orders: 190
[2025-08-31 11:26:08] === ПОДГОТОВКА ВЗАИМОДЕЙСТВИЙ ===
[2025-08-31 11:26:08] Формируем матрицу взаимодействий по батчам...
[2025-08-31 11:26:08] ... обработка orders
[2025-08-31 11:26:08] Сохранен orders-батч 0-764
[2025-08-31 11:26:08] ... обработка tracker
[2025-08-31 11:26:08] Обрабатываем 10 файлов tracker
[2025-08-31 11:26:11] Обработан tracker файл 0: 5244163 строк
[2025-08-31 11:26:12] Обработан tracker файл 1: 5127852 строк
[2025-08-31 11:26:13] Обработан tracker файл 2: 5086362 строк
[2025-08-31 11:26:15] Обработан tracker файл 3: 5027294 строк
[2025-08-31 11:26:16] Обработан tracker файл 4: 5028215 строк
[2025-08-31 11:26:17] Обработан tracker файл 5: 5260057 строк
[2025-08-31 11:26:19] Обработан tracker файл 6: 5069185 строк
[2025-08-31 11:26:20] Обработан tracker файл 7: 5228792 строк
[2025-08-31 11:26:21] Обработан tracker файл 8: 5160198 строк
[2025-08-31 11:26:23] Обработан tracker файл 9: 5106416 строк
[2025-08-31 11:26:23] ✅ Все файлы успешно созданы
[2025-08-31 11:26:23] Всего файлов взаимодействий: 11
[2025-08-31 11:26:23] Подготовка взаимодействий завершена за 0:00:14.779780
[2025-08-31 11:26:23] Создано файлов взаимодействий: 11
[2025-08-31 11:26:23] === ПОСЛЕДНИЕ ТОВАРЫ ===
[2025-08-31 11:26:30] Словарь сохранен в /home/root6/python/e_cup/rec_system/data/processed/recent_items_map.pkl
[2025-08-31 11:26:30] Построение recent items map завершено за 0:00:07.322711
[2025-08-31 11:26:30] Пользователей с recent items: 942507
[2025-08-31 11:26:30] === ОБУЧЕНИЕ ALS ДЛЯ ПРИЗНАКОВ ===
[2025-08-31 11:26:30] Первый проход: построение маппингов...
[2025-08-31 11:26:31] Маппинги построены. Уников: users=942507, items=238110
[2025-08-31 11:26:31] item_map сохранен: /home/root6/python/e_cup/rec_system/data/processed/item_map.pkl
[2025-08-31 11:26:31] Сохранение батчей на диск...
[2025-08-31 11:26:32] Обучение als_model...
[2025-08-31 11:26:39] Очистка временных файлов...
[2025-08-31 11:26:39] Директория батчей удалена
[2025-08-31 11:26:39] Обучение завершено!
[2025-08-31 11:26:39] Считаем глобальную популярность на основе тренировочных данных...
[2025-08-31 11:26:39] Глобальная популярность рассчитана на 763 тренировочных заказах
[2025-08-31 11:26:39] Обучение ALS завершено за 0:00:08.884686
[2025-08-31 11:26:39] Пользователей: 942507, Товаров: 238110
[2025-08-31 11:26:39] === ПОСТРОЕНИЕ ДОПОЛНИТЕЛЬНЫХ ДАННЫХ ===
[2025-08-31 11:26:39] Строим co-purchase матрицу для топ-N товаров...
[2025-08-31 11:26:39] Топ-500 популярных товаров определены
[2025-08-31 11:26:39] Нет корзин с популярными товарами
[2025-08-31 11:26:39] Co-purchase map построен: 0 товаров
[2025-08-31 11:26:46] Построение категорийных маппингов...
[2025-08-31 11:26:46] Категорийные маппинги построены: 1000 товаров, 228 категорий
[2025-08-31 11:26:46] Построение дополнительных данных завершено за 0:00:06.736942
[2025-08-31 11:26:46] === ПРЕДВАРИТЕЛЬНЫЙ РАСЧЕТ ПРИЗНАКОВ ДЛЯ LGBM ===
[2025-08-31 11:26:46] Построение словаря пользовательских признаков...
[2025-08-31 11:26:47] Агрегация по заказам...
[2025-08-31 11:26:48] Словарь пользовательских признаков построен и сохранён в /home/root6/python/e_cup/rec_system/data/processed/cat_to_items.pkl. Записей: 942508
[2025-08-31 11:26:49] User features построены за 0:00:02.707935: 942508 пользователей
[2025-08-31 11:26:49] Построение словаря товарных признаков с батчевой обработкой...
[2025-08-31 11:26:49] Батчевая агрегация взаимодействий...
[2025-08-31 11:26:49] Объединение статистик...
[2025-08-31 11:26:49] Обработка заказов...
[2025-08-31 11:26:52] Ошибка обработки партиции 3: tuple index out of range
[2025-08-31 11:26:52] Ошибка обработки партиции 4: tuple index out of range
[2025-08-31 11:26:52] Обработка items...
[2025-08-31 11:26:52] Объединение всех данных...
[2025-08-31 11:26:52] Создание финального словаря...
[2025-08-31 11:26:52] Добавление эмбеддингов...
[2025-08-31 11:26:52] Очистка временных файлов...
[2025-08-31 11:26:52] Словарь товарных признаков построен. Записей: 239252
[2025-08-31 11:26:52] Item features: 239252 товаров, размер вектора: 7 признаков
[2025-08-31 11:26:52] Порядок признаков: ['item_count', 'item_mean', 'item_sum', 'item_max', 'item_min', 'item_orders_count', 'item_category']
[2025-08-31 11:26:52] item_features_dict[27262977] type=<class 'numpy.ndarray'>, shape=(7,), example=[ 78.          7.216255  562.8679     33.741688    5.9098206]
[2025-08-31 11:26:52] item_features_dict[298844161] type=<class 'numpy.ndarray'>, shape=(7,), example=[ 13.          8.166868  106.16929    32.108437    4.7957907]
[2025-08-31 11:26:52] item_features_dict[251658241] type=<class 'numpy.ndarray'>, shape=(7,), example=[ 26.          5.8004527 150.81177    27.850113    1.7509375]
[2025-08-31 11:26:52] item_features_dict[71303174] type=<class 'numpy.ndarray'>, shape=(7,), example=[ 22.           6.99084    153.79848     17.03921      0.36464313]
[2025-08-31 11:26:52] item_features_dict[232259597] type=<class 'numpy.ndarray'>, shape=(7,), example=[2.1100000e+02 4.2093658e+00 8.8817621e+02 3.0540012e+01 3.6464313e-01]
[2025-08-31 11:26:53] Item features построены за 0:00:03.959602
[2025-08-31 11:26:53] === ПОДГОТОВКА ДАННЫХ ДЛЯ LightGBM ===
[2025-08-31 11:26:53] Подготовка данных для LightGBM (streaming, polars lazy, векторно)...
[2025-08-31 11:26:56] ✅ Данные подготовлены без утечек памяти
[2025-08-31 11:26:56] Размер train: 1109, validation: 26
[2025-08-31 11:26:56] Признаки: 14
[2025-08-31 11:26:56] Подготовка данных для LightGBM завершена за 0:00:03.076650
[2025-08-31 11:26:56] === ДЕТАЛЬНАЯ ПРОВЕРКА FEATURE GENERATION ===
[2025-08-31 11:26:56] --- ПРОВЕРКА USER FEATURES ---
[2025-08-31 11:26:56] Пример user features для пользователя 4934900:
[2025-08-31 11:26:56]   user_count: 97
[2025-08-31 11:26:56]   user_mean: 8.482574941607268
[2025-08-31 11:26:56]   user_sum: 822.809769335905
[2025-08-31 11:26:56]   user_max: 33.80994674344636
[2025-08-31 11:26:56]   user_min: 0.36464311358790924
[2025-08-31 11:26:56]   user_orders_count: 0
[2025-08-31 11:26:56] Пользователей с features: 942508
[2025-08-31 11:26:56] Пользователей с НЕнулевыми features: 942508
[2025-08-31 11:26:56] --- ПРОВЕРКА ITEM FEATURES ---
[2025-08-31 11:26:56] Пример item features для товара 27262977:
[2025-08-31 11:26:56]   emb_0: 78.0
[2025-08-31 11:26:56]   emb_1: 7.216255187988281
[2025-08-31 11:26:56]   emb_2: 562.867919921875
[2025-08-31 11:26:56]   emb_3: 33.7416877746582
[2025-08-31 11:26:56]   emb_4: 5.909820556640625
[2025-08-31 11:26:56]   emb_5: 0.0
[2025-08-31 11:26:56]   emb_6: 0.0
[2025-08-31 11:26:56] Товаров с features: 239252
[2025-08-31 11:26:56] Товаров с НЕнулевыми features: 239252
[2025-08-31 11:26:56] --- ПРОВЕРКА ЭМБЕДДИНГОВ ---
[2025-08-31 11:26:56] Пример эмбеддинга для товара 324738852: shape (512,)
[2025-08-31 11:26:56] Эмбеддингов загружено: 1000
[2025-08-31 11:26:56] Пример значений: [ 0.00533594 -0.17438558  0.20624053  0.91315746 -0.47587407]
[2025-08-31 11:26:56] --- ПРОВЕРКА CO-PURCHASE MAP ---
[2025-08-31 11:26:56] ⚠️ copurchase_map ПУСТОЙ!
[2025-08-31 11:26:56] --- ПРОВЕРКА КАТЕГОРИЙНЫХ МАППИНГОВ ---
[2025-08-31 11:26:56] Товар 324738852 -> категория 7644
[2025-08-31 11:26:56] Категория 7644 -> 14 товаров
[2025-08-31 11:26:56] Товаров в маппинге: 1000
[2025-08-31 11:26:56] Категорий в маппинге: 228
[2025-08-31 11:26:56] Проверка признаков завершена за 0:00:00.450229
[2025-08-31 11:26:56] === ОБУЧЕНИЕ LightGBM ===
[2025-08-31 11:26:56] === ДЕБАГ ИНФОРМАЦИЯ: TRAIN ===
[2025-08-31 11:26:56] Размер: 1109 строк
[2025-08-31 11:26:56] Колонки: ['item_id', 'user_id', 'created_timestamp', 'last_status', 'target', 'weight', 'user_count', 'user_mean', 'user_sum', 'user_max', 'user_min', 'user_orders_count', 'emb_0', 'emb_1', 'emb_2', 'emb_3', 'emb_4', 'emb_5', 'emb_6', 'copurchase_count']
[2025-08-31 11:26:56] ✅ Все признаки присутствуют
[2025-08-31 11:26:56] Целевая переменная: {1: np.int64(604), 0: np.int64(505)}
[2025-08-31 11:26:56] Пример первой строки:
[2025-08-31 11:26:56]   item_id: 88607541
[2025-08-31 11:26:56]   user_id: 4213471
[2025-08-31 11:26:56]   created_timestamp: 2025-05-18 16:58:19.960000
[2025-08-31 11:26:56]   last_status: delivered_orders
[2025-08-31 11:26:56]   target: 1
[2025-08-31 11:26:56]   weight: 5.148097085905792
[2025-08-31 11:26:56]   user_count: 48.0
[2025-08-31 11:26:56]   user_mean: 6.672139870778023
[2025-08-31 11:26:56]   user_sum: 320.2627137973451
[2025-08-31 11:26:56]   user_max: 29.652730660692825
[2025-08-31 11:26:56]   user_min: 0.6729444732424259
[2025-08-31 11:26:56]   user_orders_count: 1.0
[2025-08-31 11:26:56]   emb_0: 1.0
[2025-08-31 11:26:56]   emb_1: 5.148097038269043
[2025-08-31 11:26:56]   emb_2: 5.148097038269043
[2025-08-31 11:26:56]   emb_3: 5.148097038269043
[2025-08-31 11:26:56]   emb_4: 5.148097038269043
[2025-08-31 11:26:56]   emb_5: 1.0
[2025-08-31 11:26:56]   emb_6: 0.0
[2025-08-31 11:26:56]   copurchase_count: 0.0
[2025-08-31 11:26:56] === ДЕБАГ ИНФОРМАЦИЯ: VAL ===
[2025-08-31 11:26:56] Размер: 26 строк
[2025-08-31 11:26:56] Колонки: ['item_id', 'user_id', 'created_timestamp', 'last_status', 'target', 'weight', 'user_count', 'user_mean', 'user_sum', 'user_max', 'user_min', 'user_orders_count', 'emb_0', 'emb_1', 'emb_2', 'emb_3', 'emb_4', 'emb_5', 'emb_6', 'copurchase_count']
[2025-08-31 11:26:56] ✅ Все признаки присутствуют
[2025-08-31 11:26:56] Целевая переменная: {0: np.int64(17), 1: np.int64(9)}
[2025-08-31 11:26:56] Пример первой строки:
[2025-08-31 11:26:56]   item_id: 263230680
[2025-08-31 11:26:56]   user_id: 3348900
[2025-08-31 11:26:56]   created_timestamp: 2025-05-25 20:21:59.520000
[2025-08-31 11:26:56]   last_status: delivered_orders
[2025-08-31 11:26:56]   target: 1
[2025-08-31 11:26:56]   weight: 1.6823611831060648
[2025-08-31 11:26:56]   user_count: 356
[2025-08-31 11:26:56]   user_mean: 5.033685140791581
[2025-08-31 11:26:56]   user_sum: 1791.991910121803
[2025-08-31 11:26:56]   user_max: 22.407096892759583
[2025-08-31 11:26:56]   user_min: 0.6729444732424259
[2025-08-31 11:26:56]   user_orders_count: 1
[2025-08-31 11:26:56]   emb_0: 1.0
[2025-08-31 11:26:56]   emb_1: 1.682361125946045
[2025-08-31 11:26:56]   emb_2: 1.682361125946045
[2025-08-31 11:26:56]   emb_3: 1.682361125946045
[2025-08-31 11:26:56]   emb_4: 1.682361125946045
[2025-08-31 11:26:56]   emb_5: 1.0
[2025-08-31 11:26:56]   emb_6: 0.0
[2025-08-31 11:26:56]   copurchase_count: 0.0
[2025-08-31 11:26:56] Feature columns: ['copurchase_count', 'user_count', 'user_mean', 'user_sum', 'user_max', 'user_min', 'user_orders_count', 'emb_0', 'emb_1', 'emb_2', 'emb_3', 'emb_4', 'emb_5', 'emb_6']
[2025-08-31 11:26:56] Размер train: 1109
[2025-08-31 11:26:56] Количество пользователей в train: 936
[2025-08-31 11:26:56] Размер val: 26
[2025-08-31 11:26:56] Количество пользователей в val: 18
[2025-08-31 11:26:56] [Iter 0] train_ndcg@100: 0.011752, valid_ndcg@100: 0.000000
[2025-08-31 11:26:56] ✅ [Iter 0] Новый лучший valid_ndcg@100: 0.000000
[2025-08-31 11:26:56] 🎯 Финальный NDCG@100 на валидации: 0.419098
[2025-08-31 11:26:56] 📈 Лучший NDCG@100: 0.000000 на итерации 0
[2025-08-31 11:26:56] Обучение LightGBM завершено за 0:00:00.257458
[2025-08-31 11:26:56] === ВАЖНОСТЬ ПРИЗНАКОВ ===
[2025-08-31 11:26:56] Топ-20 важных признаков:
[2025-08-31 11:26:56]   emb_1: 27
[2025-08-31 11:26:56]   user_max: 11
[2025-08-31 11:26:56]   emb_3: 8
[2025-08-31 11:26:56]   emb_2: 7
[2025-08-31 11:26:56]   user_min: 3
[2025-08-31 11:26:56]   emb_0: 2
[2025-08-31 11:26:56]   emb_4: 1
[2025-08-31 11:26:56]   user_mean: 1
[2025-08-31 11:26:56]   copurchase_count: 0
[2025-08-31 11:26:56]   user_count: 0
[2025-08-31 11:26:56]   user_sum: 0
[2025-08-31 11:26:56]   user_orders_count: 0
[2025-08-31 11:26:56]   emb_5: 0
[2025-08-31 11:26:56]   emb_6: 0
[2025-08-31 11:26:56] Анализ важности признаков завершен за 0:00:00.001252
[2025-08-31 11:26:56] === СОХРАНЕНИЕ МОДЕЛИ И ПРИЗНАКОВ ===
[2025-08-31 11:26:58] Сохранение модели завершено за 0:00:01.557901
[2025-08-31 11:26:58] Модель сохранена в: /home/root6/python/e_cup/rec_system/src/models/lgbm_model_full.pkl
[2025-08-31 11:26:58] === ОБУЧЕНИЕ И ПРЕДСКАЗАНИЯ ЗАВЕРШЕНЫ УСПЕШНО ===
[2025-08-31 11:26:58] Общее время выполнения: 0:03:14.215947
[2025-08-31 11:26:58] Пользователей: 942507
[2025-08-31 11:26:58] Товаров: 238110
[2025-08-31 11:26:58] Признаков: 14
[2025-08-31 11:26:58] === СИСТЕМНАЯ ИНФОРМАЦИЯ ===
[2025-08-31 11:26:58] Видеокарта: NVIDIA GeForce RTX 4090
[2025-08-31 11:26:58] Память GPU: 24.0 GB
[2025-08-31 11:26:58] Процессор: 27.1% загрузки
[2025-08-31 11:26:58] Ядра CPU: 32
[2025-08-31 11:26:58] Частота CPU: 2995.2 MHz
[2025-08-31 11:26:58] Оперативная память: 94.2 GB всего, 59.8 GB использовано
[2025-08-31 11:26:58] ==========================================
[2025-08-31 11:26:58] ВСЕ ЭТАПЫ ВЫПОЛНЕНЫ УСПЕШНО!
[2025-08-31 11:26:58] ==========================================

=== ОБЩЕЕ ВРЕМЯ ВЫПОЛНЕНИЯ: 0:03:14.216877 ===
