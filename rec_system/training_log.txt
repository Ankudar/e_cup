=== НАЧАЛО ОБУЧЕНИЯ 2025-08-29 13:43:49 ===

[2025-08-29 13:43:49] === РЕЖИМ МАСШТАБИРОВАНИЯ: FULL ===
[2025-08-29 13:43:49] Пользователей: все
[2025-08-29 13:43:49] Данных: 100.0%
[2025-08-29 13:43:49] === ЗАГРУЗКА ДАННЫХ ===
[2025-08-29 13:43:49] Загружаем данные...
[2025-08-29 13:43:49] orders: 1,000 строк (использовано 5 из 5 партиций), ~0.0 MB
[2025-08-29 13:43:50] tracker: 1,000 строк (использовано 200 из 200 партиций), ~0.0 MB
[2025-08-29 13:43:51] items: 1,000 строк (использовано 200 из 200 партиций), ~0.2 MB
[2025-08-29 13:43:51] categories: 1,000 строк (использовано 1 из 1 партиций), ~0.2 MB
[2025-08-29 13:43:51] test_users: 1,000 строк (использовано 1 из 1 партиций), ~0.0 MB
[2025-08-29 13:43:51] Данные загружены
[2025-08-29 13:43:51] Фильтрация данных...
[2025-08-29 13:43:51] Фильтрация завершена
[2025-08-29 13:43:51] Загрузка данных завершена за 0:00:02.110742
[2025-08-29 13:43:51] === ЗАГРУЗКА ЭМБЕДДИНГОВ ===
[2025-08-29 13:43:51] Оптимизированная потоковая загрузка эмбеддингов...
[2025-08-29 13:43:51] Загружено эмбеддингов для 990 товаров
[2025-08-29 13:43:51] Пример ключей в embeddings_dict: [400301, 678602, 746401, 872829, 893255]
[2025-08-29 13:43:51] Пример значения: [ 0.32023853  0.11766258 -0.784552    0.4168199  -0.24610527]
[2025-08-29 13:43:51] Загрузка эмбеддингов завершена за 0:00:00.754519
[2025-08-29 13:43:51] Загружено эмбеддингов: 990
[2025-08-29 13:43:51] === SPLIT ДАННЫХ ===
[2025-08-29 13:43:52] Split данных завершен за 0:00:00.296646
[2025-08-29 13:43:52] Train orders: 753, Test orders: 187
[2025-08-29 13:43:52] === ПОДГОТОВКА ВЗАИМОДЕЙСТВИЙ ===
[2025-08-29 13:43:52] Формируем матрицу взаимодействий по батчам...
[2025-08-29 13:43:52] ✅ Найдено 2 существующих файлов, пропускаем создание
[2025-08-29 13:43:52] Подготовка взаимодействий завершена за 0:00:00.000245
[2025-08-29 13:43:52] Создано файлов взаимодействий: 2
[2025-08-29 13:43:52] === ПОСЛЕДНИЕ ТОВАРЫ ===
[2025-08-29 13:43:52] Словарь сохранен в /home/root6/python/e_cup/rec_system/data/processed/recent_items_map.pkl
[2025-08-29 13:43:52] Построение recent items map завершено за 0:00:00.025932
[2025-08-29 13:43:52] Пользователей с recent items: 1195
[2025-08-29 13:43:52] === ОБУЧЕНИЕ ALS ДЛЯ ПРИЗНАКОВ ===
[2025-08-29 13:43:52] Первый проход: построение маппингов...
[2025-08-29 13:43:52] Маппинги построены. Уников: users=1195, items=207
[2025-08-29 13:43:52] item_map сохранен: /home/root6/python/e_cup/rec_system/data/processed/item_map.pkl
[2025-08-29 13:43:52] Сохранение батчей на диск...
[2025-08-29 13:43:52] Постепенное обучение...
[2025-08-29 13:43:53] Очистка временных файлов...
[2025-08-29 13:43:53] Директория батчей удалена
[2025-08-29 13:43:53] Обучение завершено!
[2025-08-29 13:43:53] Считаем глобальную популярность на основе тренировочных данных...
[2025-08-29 13:43:53] Глобальная популярность рассчитана на 752 тренировочных заказах
[2025-08-29 13:43:53] Обучение ALS завершено за 0:00:01.146217
[2025-08-29 13:43:53] Пользователей: 1195, Товаров: 207
[2025-08-29 13:43:53] === ПОСТРОЕНИЕ ДОПОЛНИТЕЛЬНЫХ ДАННЫХ ===
[2025-08-29 13:43:53] Строим co-purchase матрицу для топ-N товаров...
[2025-08-29 13:43:53] Топ-207 популярных товаров определены
[2025-08-29 13:43:53] Обрабатываем 3 корзин с популярными товарами
[2025-08-29 13:43:53] Уникальных популярных товаров: 207
[2025-08-29 13:43:53] Создаем sparse матрицу из 6 взаимодействий...
[2025-08-29 13:43:53] Sparse матрица построена: torch.Size([207, 207]), ненулевых элементов: 3
[2025-08-29 13:43:53] Формируем рекомендации...
[2025-08-29 13:43:53] Co-purchase словарь построен для 3 товаров
[2025-08-29 13:43:53] В среднем 1.0 рекомендаций на товар
[2025-08-29 13:43:53] Co-purchase map построен: 3 товаров
[2025-08-29 13:43:53] Построение категорийных маппингов...
[2025-08-29 13:43:53] Категорийные маппинги построены: 990 товаров, 223 категорий
[2025-08-29 13:43:53] Построение дополнительных данных завершено за 0:00:00.352192
[2025-08-29 13:43:53] === ПРЕДВАРИТЕЛЬНЫЙ РАСЧЕТ ПРИЗНАКОВ ДЛЯ LGBM ===
[2025-08-29 13:43:53] Построение словаря пользовательских признаков...
[2025-08-29 13:43:53] Агрегация по заказам...
[2025-08-29 13:43:54] Словарь пользовательских признаков построен и сохранён в /home/root6/python/e_cup/rec_system/data/processed/cat_to_items.pkl. Записей: 1196
[2025-08-29 13:43:54] User features построены за 0:00:00.319897: 1196 пользователей
[2025-08-29 13:43:54] Построение словаря товарных признаков...
[2025-08-29 13:43:54] Добавление данных из items_df...
[2025-08-29 13:43:54] Добавление эмбеддингов...
[2025-08-29 13:43:54] Словарь товарных признаков построен. Записей: 208
[2025-08-29 13:43:54] Item features: 208 товаров, размер вектора: 7 признаков
[2025-08-29 13:43:54] Порядок признаков: ['item_count', 'item_mean', 'item_sum', 'item_max', 'item_min', 'item_orders_count', 'item_category']
[2025-08-29 13:43:54] item_features_dict[3308074] type=<class 'numpy.ndarray'>, shape=(7,), example=[ 1.       15.028413 15.028413 15.028413 15.028413]
[2025-08-29 13:43:54] item_features_dict[5503565] type=<class 'numpy.ndarray'>, shape=(7,), example=[ 1.       13.925056 13.925056 13.925056 13.925056]
[2025-08-29 13:43:54] item_features_dict[2537225] type=<class 'numpy.ndarray'>, shape=(7,), example=[ 1.       12.824747 12.824747 12.824747 12.824747]
[2025-08-29 13:43:54] item_features_dict[4709973] type=<class 'numpy.ndarray'>, shape=(7,), example=[ 1.       12.824747 12.824747 12.824747 12.824747]
[2025-08-29 13:43:54] item_features_dict[8373286] type=<class 'numpy.ndarray'>, shape=(7,), example=[ 2.        13.0318985 26.063797  16.479185   9.584613 ]
[2025-08-29 13:43:54] Item features построены за 0:00:00.709482
[2025-08-29 13:43:54] === ПОДГОТОВКА ДАННЫХ ДЛЯ LightGBM ===
[2025-08-29 13:43:54] Подготовка данных для LightGBM (streaming, polars lazy, векторно)...
[2025-08-29 13:43:55] ✅ Данные подготовлены без утечек памяти
[2025-08-29 13:43:55] Размер train: 1060, validation: 27
[2025-08-29 13:43:55] Признаки: 14
[2025-08-29 13:43:55] Подготовка данных для LightGBM завершена за 0:00:00.684942
[2025-08-29 13:43:55] === ДЕТАЛЬНАЯ ПРОВЕРКА FEATURE GENERATION ===
[2025-08-29 13:43:55] --- ПРОВЕРКА USER FEATURES ---
[2025-08-29 13:43:55] Пример user features для пользователя 3155230:
[2025-08-29 13:43:55]   user_count: 1
[2025-08-29 13:43:55]   user_mean: 13.54025100551105
[2025-08-29 13:43:55]   user_sum: 13.54025100551105
[2025-08-29 13:43:55]   user_max: 13.54025100551105
[2025-08-29 13:43:55]   user_min: 13.54025100551105
[2025-08-29 13:43:55]   user_orders_count: 1
[2025-08-29 13:43:55] Пользователей с features: 1196
[2025-08-29 13:43:55] Пользователей с НЕнулевыми features: 1196
[2025-08-29 13:43:55] --- ПРОВЕРКА ITEM FEATURES ---
[2025-08-29 13:43:55] Пример item features для товара 3308074:
[2025-08-29 13:43:55]   emb_0: 1.0
[2025-08-29 13:43:55]   emb_1: 15.028412818908691
[2025-08-29 13:43:55]   emb_2: 15.028412818908691
[2025-08-29 13:43:55]   emb_3: 15.028412818908691
[2025-08-29 13:43:55]   emb_4: 15.028412818908691
[2025-08-29 13:43:55]   emb_5: 1.0
[2025-08-29 13:43:55]   emb_6: 0.0
[2025-08-29 13:43:55] Товаров с features: 208
[2025-08-29 13:43:55] Товаров с НЕнулевыми features: 208
[2025-08-29 13:43:55] --- ПРОВЕРКА ЭМБЕДДИНГОВ ---
[2025-08-29 13:43:55] Пример эмбеддинга для товара 400301: shape (512,)
[2025-08-29 13:43:55] Эмбеддингов загружено: 990
[2025-08-29 13:43:55] Пример значений: [ 0.32023853  0.11766258 -0.784552    0.4168199  -0.24610527]
[2025-08-29 13:43:55] --- ПРОВЕРКА CO-PURCHASE MAP ---
[2025-08-29 13:43:55] Пример co-purchase для товара 10126067: 1 товаров
[2025-08-29 13:43:55] Co-purchase записей: 3
[2025-08-29 13:43:55] --- ПРОВЕРКА КАТЕГОРИЙНЫХ МАППИНГОВ ---
[2025-08-29 13:43:55] Товар 400301 -> категория 17080
[2025-08-29 13:43:55] Категория 17080 -> 4 товаров
[2025-08-29 13:43:55] Товаров в маппинге: 990
[2025-08-29 13:43:55] Категорий в маппинге: 223
[2025-08-29 13:43:55] Проверка признаков завершена за 0:00:00.001388
[2025-08-29 13:43:55] === ОБУЧЕНИЕ LightGBM ===
[2025-08-29 13:43:55] === ДЕБАГ ИНФОРМАЦИЯ: TRAIN ===
[2025-08-29 13:43:55] Размер: 1060 строк
[2025-08-29 13:43:55] Колонки: ['item_id', 'user_id', 'created_timestamp', 'last_status', 'target', 'weight', 'user_count', 'user_mean', 'user_sum', 'user_max', 'user_min', 'user_orders_count', 'emb_0', 'emb_1', 'emb_2', 'emb_3', 'emb_4', 'emb_5', 'emb_6', 'copurchase_count']
[2025-08-29 13:43:55] ✅ Все признаки присутствуют
[2025-08-29 13:43:55] Целевая переменная: {0: np.int64(556), 1: np.int64(504)}
[2025-08-29 13:43:55] Пример первой строки:
[2025-08-29 13:43:55]   item_id: 5420725
[2025-08-29 13:43:55]   user_id: 2997780
[2025-08-29 13:43:55]   created_timestamp: 2025-03-07 01:59:49.420000
[2025-08-29 13:43:55]   last_status: canceled_orders
[2025-08-29 13:43:55]   target: 0
[2025-08-29 13:43:55]   weight: 14.339494510220533
[2025-08-29 13:43:55]   user_count: 1.0
[2025-08-29 13:43:55]   user_mean: 14.339494510220533
[2025-08-29 13:43:55]   user_sum: 14.339494510220533
[2025-08-29 13:43:55]   user_max: 14.339494510220533
[2025-08-29 13:43:55]   user_min: 14.339494510220533
[2025-08-29 13:43:55]   user_orders_count: 1.0
[2025-08-29 13:43:55]   emb_0: 20.0
[2025-08-29 13:43:55]   emb_1: 15.504387855529785
[2025-08-29 13:43:55]   emb_2: 310.0877685546875
[2025-08-29 13:43:55]   emb_3: 17.039209365844727
[2025-08-29 13:43:55]   emb_4: 13.540250778198242
[2025-08-29 13:43:55]   emb_5: 20.0
[2025-08-29 13:43:55]   emb_6: 0.0
[2025-08-29 13:43:55]   copurchase_count: 0.0
[2025-08-29 13:43:55] === ДЕБАГ ИНФОРМАЦИЯ: VAL ===
[2025-08-29 13:43:55] Размер: 27 строк
[2025-08-29 13:43:55] Колонки: ['item_id', 'user_id', 'created_timestamp', 'last_status', 'target', 'weight', 'user_count', 'user_mean', 'user_sum', 'user_max', 'user_min', 'user_orders_count', 'emb_0', 'emb_1', 'emb_2', 'emb_3', 'emb_4', 'emb_5', 'emb_6', 'copurchase_count']
[2025-08-29 13:43:55] ✅ Все признаки присутствуют
[2025-08-29 13:43:55] Целевая переменная: {1: np.int64(18), 0: np.int64(9)}
[2025-08-29 13:43:55] Пример первой строки:
[2025-08-29 13:43:55]   item_id: 5888241
[2025-08-29 13:43:55]   user_id: 1291861
[2025-08-29 13:43:55]   created_timestamp: 2025-05-26 20:00:20.453000
[2025-08-29 13:43:55]   last_status: canceled_orders
[2025-08-29 13:43:55]   target: 0
[2025-08-29 13:43:55]   weight: 1.6823611831060648
[2025-08-29 13:43:55]   user_count: 1
[2025-08-29 13:43:55]   user_mean: 1.6823611831060648
[2025-08-29 13:43:55]   user_sum: 1.6823611831060648
[2025-08-29 13:43:55]   user_max: 1.6823611831060648
[2025-08-29 13:43:55]   user_min: 1.6823611831060648
[2025-08-29 13:43:55]   user_orders_count: 1
[2025-08-29 13:43:55]   emb_0: 59.0
[2025-08-29 13:43:55]   emb_1: 9.874804496765137
[2025-08-29 13:43:55]   emb_2: 582.6134643554688
[2025-08-29 13:43:55]   emb_3: 14.61580753326416
[2025-08-29 13:43:55]   emb_4: 1.682361125946045
[2025-08-29 13:43:55]   emb_5: 83.0
[2025-08-29 13:43:55]   emb_6: 7517.0
[2025-08-29 13:43:55]   copurchase_count: 0.0
[2025-08-29 13:43:55] Feature columns: ['copurchase_count', 'user_count', 'user_mean', 'user_sum', 'user_max', 'user_min', 'user_orders_count', 'emb_0', 'emb_1', 'emb_2', 'emb_3', 'emb_4', 'emb_5', 'emb_6']
[2025-08-29 13:43:55] Размер train: 1060
[2025-08-29 13:43:55] Количество пользователей в train: 886
[2025-08-29 13:43:55] Размер val: 27
[2025-08-29 13:43:55] Количество пользователей в val: 21
[2025-08-29 13:43:55] [Iter 0] train_ndcg@100: 0.481727, valid_ndcg@100: 0.676265
[2025-08-29 13:43:57] ✅ [Iter 6] Новый лучший valid_ndcg@100: 0.680088
[2025-08-29 13:43:59] [Iter 10] train_ndcg@100: 0.484734, valid_ndcg@100: 0.680088
[2025-08-29 13:44:02] ⏹️ Ранняя остановка на итерации 16. Лучший NDCG@100=0.680088 (iter 6)
[2025-08-29 13:44:02] 🎯 Финальный NDCG@100 на валидации: 0.680088
[2025-08-29 13:44:02] 📈 Лучший NDCG@100: 0.680088 на итерации 6
[2025-08-29 13:44:02] Обучение LightGBM завершено за 0:00:06.558678
[2025-08-29 13:44:02] === ВАЖНОСТЬ ПРИЗНАКОВ ===
[2025-08-29 13:44:02] Топ-20 важных признаков:
[2025-08-29 13:44:02]   emb_2: 46
[2025-08-29 13:44:02]   emb_1: 41
[2025-08-29 13:44:02]   emb_3: 32
[2025-08-29 13:44:02]   emb_5: 31
[2025-08-29 13:44:02]   emb_0: 26
[2025-08-29 13:44:02]   user_orders_count: 14
[2025-08-29 13:44:02]   emb_4: 11
[2025-08-29 13:44:02]   user_mean: 4
[2025-08-29 13:44:02]   emb_6: 4
[2025-08-29 13:44:02]   user_sum: 3
[2025-08-29 13:44:02]   user_min: 1
[2025-08-29 13:44:02]   user_max: 1
[2025-08-29 13:44:02]   copurchase_count: 0
[2025-08-29 13:44:02]   user_count: 0
[2025-08-29 13:44:02] Анализ важности признаков завершен за 0:00:00.001254
[2025-08-29 13:44:02] === СОХРАНЕНИЕ МОДЕЛИ И ПРИЗНАКОВ ===
[2025-08-29 13:44:02] Сохранение модели завершено за 0:00:00.014337
[2025-08-29 13:44:02] Модель сохранена в: /home/root6/python/e_cup/rec_system/src/models/lgbm_model_full.pkl
[2025-08-29 13:44:02] === ОБУЧЕНИЕ И ПРЕДСКАЗАНИЯ ЗАВЕРШЕНЫ УСПЕШНО ===
[2025-08-29 13:44:02] Общее время выполнения: 0:00:12.977676
[2025-08-29 13:44:02] Пользователей: 1195
[2025-08-29 13:44:02] Товаров: 207
[2025-08-29 13:44:02] Признаков: 14
[2025-08-29 13:44:02] === СИСТЕМНАЯ ИНФОРМАЦИЯ ===
[2025-08-29 13:44:02] Видеокарта: NVIDIA GeForce RTX 4090
[2025-08-29 13:44:02] Память GPU: 24.0 GB
[2025-08-29 13:44:02] Процессор: 45.1% загрузки
[2025-08-29 13:44:02] Ядра CPU: 32
[2025-08-29 13:44:02] Частота CPU: 2995.2 MHz
[2025-08-29 13:44:02] Оперативная память: 94.2 GB всего, 5.8 GB использовано
[2025-08-29 13:44:02] Частота RAM: информация требует дополнительных библиотек
[2025-08-29 13:44:02] ==========================================
[2025-08-29 13:44:02] ВСЕ ЭТАПЫ ВЫПОЛНЕНЫ УСПЕШНО!
[2025-08-29 13:44:02] ==========================================

=== ОБЩЕЕ ВРЕМЯ ВЫПОЛНЕНИЯ: 0:00:12.978706 ===
